---
phase: 60-frontend-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/lib/core/constants.dart
  - frontend/lib/providers/provider_provider.dart
  - frontend/lib/screens/settings_screen.dart
  - backend/app/routes/threads.py
autonomous: true

must_haves:
  truths:
    - "Settings dropdown shows 'Claude Code (SDK)' with experimental badge and model name"
    - "Settings dropdown shows 'Claude Code (CLI)' with experimental badge and model name"
    - "Selecting a Claude Code provider persists across app restart"
    - "Creating a thread with claude-code-sdk or claude-code-cli provider succeeds (backend accepts it)"
  artifacts:
    - path: "frontend/lib/core/constants.dart"
      provides: "ProviderConfig with isExperimental and modelName fields, claude-code-sdk and claude-code-cli configs"
      contains: "claudeCodeSdk"
    - path: "frontend/lib/providers/provider_provider.dart"
      provides: "claude-code-sdk and claude-code-cli in available providers list"
      contains: "claude-code-sdk"
    - path: "frontend/lib/screens/settings_screen.dart"
      provides: "Dropdown items showing experimental badge and model name for Claude Code providers"
      contains: "isExperimental"
    - path: "backend/app/routes/threads.py"
      provides: "claude-code-sdk and claude-code-cli in VALID_PROVIDERS"
      contains: "claude-code-sdk"
  key_links:
    - from: "frontend/lib/screens/settings_screen.dart"
      to: "frontend/lib/core/constants.dart"
      via: "ProviderConfigs.all iteration with isExperimental/modelName display"
      pattern: "config\\.isExperimental"
    - from: "frontend/lib/providers/provider_provider.dart"
      to: "frontend/lib/core/constants.dart"
      via: "_availableProviders list matching ProviderConfigs.all IDs"
      pattern: "claude-code-sdk"
    - from: "backend/app/routes/threads.py"
      to: "backend/app/services/llm/factory.py"
      via: "VALID_PROVIDERS matching LLMProvider enum values"
      pattern: "claude-code-sdk"
---

<objective>
Register Claude Code providers (SDK and CLI) across the full stack so users can select them in settings and create threads with them.

Purpose: This is the core plumbing that makes Claude Code providers selectable and functional. Without this, no threads can use the new providers.
Output: Users see Claude Code (SDK) and Claude Code (CLI) in the settings dropdown with experimental badges and model names. Backend accepts these as valid providers for thread creation.
</objective>

<execution_context>
@C:/Users/ibcve/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ibcve/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/60-frontend-integration/60-CONTEXT.md
@.planning/phases/60-frontend-integration/60-RESEARCH.md
@frontend/lib/core/constants.dart
@frontend/lib/providers/provider_provider.dart
@frontend/lib/screens/settings_screen.dart
@backend/app/routes/threads.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Claude Code providers to backend and frontend registration</name>
  <files>
    backend/app/routes/threads.py
    frontend/lib/core/constants.dart
    frontend/lib/providers/provider_provider.dart
  </files>
  <action>
    **Backend (threads.py):**
    Add "claude-code-sdk" and "claude-code-cli" to the VALID_PROVIDERS list on line 30. Change from:
    ```python
    VALID_PROVIDERS = ["anthropic", "google", "deepseek"]
    ```
    to:
    ```python
    VALID_PROVIDERS = ["anthropic", "google", "deepseek", "claude-code-sdk", "claude-code-cli"]
    ```

    **Frontend constants.dart:**
    1. Add two optional fields to ProviderConfig class:
       - `final bool isExperimental` (default false)
       - `final String? modelName` (nullable, default null)
       Update the constructor to include these as optional named parameters with defaults.

    2. Add two new static configs to ProviderConfigs:
       ```dart
       static const claudeCodeSdk = ProviderConfig(
         id: 'claude-code-sdk',
         displayName: 'Claude Code (SDK)',
         color: Color(0xFFD97706), // Same Anthropic orange
         icon: Icons.code_outlined,
         isExperimental: true,
         modelName: 'Claude Sonnet 4.5',
       );

       static const claudeCodeCli = ProviderConfig(
         id: 'claude-code-cli',
         displayName: 'Claude Code (CLI)',
         color: Color(0xFFD97706), // Same Anthropic orange
         icon: Icons.terminal_outlined,
         isExperimental: true,
         modelName: 'Claude Sonnet 4.5',
       );
       ```

    3. Add cases for 'claude-code-sdk' and 'claude-code-cli' in getConfig() switch statement (before the default case).

    4. Add claudeCodeSdk and claudeCodeCli to the `all` list.

    **Frontend provider_provider.dart:**
    Add 'claude-code-sdk' and 'claude-code-cli' to the _availableProviders list. This is CRITICAL — without this, setProvider() will throw ArgumentError when user selects a Claude Code provider.
  </action>
  <verify>
    Run backend tests to verify VALID_PROVIDERS accepts new values:
    ```bash
    cd backend && python -m pytest tests/unit/ -x -q 2>&1 | tail -5
    ```
    Run flutter analyze to verify frontend compiles after changes:
    ```bash
    cd frontend && flutter analyze lib/core/constants.dart lib/providers/provider_provider.dart 2>&1 | tail -10
    ```
    Verify all three files have the new provider IDs present.
  </verify>
  <done>
    - VALID_PROVIDERS in threads.py contains "claude-code-sdk" and "claude-code-cli"
    - ProviderConfig has isExperimental and modelName fields
    - ProviderConfigs has claudeCodeSdk and claudeCodeCli entries with isExperimental: true and modelName set
    - getConfig() returns correct config for both new provider IDs
    - ProviderConfigs.all includes both new providers
    - ProviderProvider._availableProviders includes both new provider IDs
  </done>
</task>

<task type="auto">
  <name>Task 2: Update settings dropdown to show experimental badges and model names</name>
  <files>
    frontend/lib/screens/settings_screen.dart
  </files>
  <action>
    Update the dropdown items in the Consumer<ProviderProvider> builder (around line 105-117) to display experimental badges and model names for Claude Code providers.

    Replace the current DropdownMenuItem child Row with an enhanced version:
    ```dart
    DropdownMenuItem<String>(
      value: config.id,
      child: Row(
        mainAxisSize: MainAxisSize.min,
        children: [
          Icon(config.icon, color: config.color, size: 20),
          const SizedBox(width: 8),
          Text(config.displayName),
          // Experimental badge for Claude Code providers
          if (config.isExperimental) ...[
            const SizedBox(width: 8),
            Container(
              padding: const EdgeInsets.symmetric(horizontal: 6, vertical: 2),
              decoration: BoxDecoration(
                color: Theme.of(context).colorScheme.secondaryContainer,
                borderRadius: BorderRadius.circular(4),
              ),
              child: Text(
                'EXPERIMENTAL',
                style: TextStyle(
                  fontSize: 10,
                  fontWeight: FontWeight.w600,
                  color: Theme.of(context).colorScheme.onSecondaryContainer,
                ),
              ),
            ),
          ],
          // Model name for providers with modelName set
          if (config.modelName != null) ...[
            const SizedBox(width: 8),
            Text(
              '\u2014 ${config.modelName}',
              style: Theme.of(context).textTheme.bodySmall?.copyWith(
                color: Theme.of(context).colorScheme.onSurfaceVariant,
              ),
            ),
          ],
        ],
      ),
    );
    ```

    Use em-dash (\u2014) as separator per user decision: "Claude Code (SDK) — Claude Sonnet 4".

    IMPORTANT: The `context` inside the DropdownMenuItem builder refers to the outer build context. Since this is inside a Consumer builder, use the context parameter from the Consumer's builder function.
  </action>
  <verify>
    Run flutter analyze to verify settings_screen.dart compiles after changes:
    ```bash
    cd frontend && flutter analyze lib/screens/settings_screen.dart 2>&1 | tail -10
    ```
    Verify the if-statements use the spread operator correctly (`if (condition) ...[widgets]`).
  </verify>
  <done>
    - Settings dropdown shows "EXPERIMENTAL" badge next to Claude Code provider names
    - Settings dropdown shows "— Claude Sonnet 4.5" model name next to Claude Code provider names
    - Existing providers (Claude, Gemini, DeepSeek) render without badges or model names (isExperimental is false, modelName is null)
    - Badge uses secondaryContainer color scheme for consistent Material 3 styling
  </done>
</task>

</tasks>

<verification>
1. Backend VALID_PROVIDERS list contains all 5 providers: anthropic, google, deepseek, claude-code-sdk, claude-code-cli
2. ProviderConfig class has isExperimental (bool) and modelName (String?) fields
3. ProviderConfigs.all has 5 entries (3 existing + 2 new)
4. ProviderConfigs.getConfig('claude-code-sdk') returns claudeCodeSdk config
5. ProviderConfigs.getConfig('claude-code-cli') returns claudeCodeCli config
6. ProviderProvider._availableProviders has 5 entries matching ProviderConfigs.all IDs
7. Settings dropdown items render experimental badge and model name for Claude Code providers
8. Existing providers render without experimental badge or model name
9. Backend unit tests pass without regression
10. `flutter analyze` passes for all modified frontend files (constants.dart, provider_provider.dart, settings_screen.dart)
11. Backend pytest confirms Claude Code adapters can be instantiated (run: `python -m pytest tests/unit/ -k "claude_code or adapter" -x -q`)

**End-to-end streaming coverage (UI-04):**
Registering providers in VALID_PROVIDERS and the frontend dropdown IS what makes end-to-end streaming work for Claude Code providers. The Phase 58/59 adapters (ClaudeCodeSDKAdapter, ClaudeCLIAdapter) normalize all output to the same StreamChunk/ChatEvent format consumed by the existing provider-agnostic streaming display. No new streaming code is required — the existing MessageBubble, StreamingMessage, and thinking UI handle all ChatEvent types identically regardless of provider. Manual E2E testing (send message, verify AI response streams, thinking displays, tools execute) will be captured in `.planning/TESTING-QUEUE.md` per project deferred testing convention.
</verification>

<success_criteria>
- User can select "Claude Code (SDK)" from settings dropdown and sees "EXPERIMENTAL" badge + "Claude Sonnet 4.5" model name
- User can select "Claude Code (CLI)" from settings dropdown and sees "EXPERIMENTAL" badge + "Claude Sonnet 4.5" model name
- Provider selection persists across app restart (ProviderProvider validates new IDs)
- Backend accepts thread creation with claude-code-sdk or claude-code-cli provider
- `flutter analyze` passes cleanly for all modified frontend files (no compilation errors)
- End-to-end streaming works for Claude Code providers because: (1) providers registered in VALID_PROVIDERS, (2) providers registered in frontend dropdown, (3) Phase 58/59 adapters normalize to ChatEvent format, (4) existing streaming display handles all ChatEvent types identically. Manual E2E streaming verification deferred to TESTING-QUEUE.md per project convention.
</success_criteria>

<output>
After completion, create `.planning/phases/60-frontend-integration/60-01-SUMMARY.md`
</output>
