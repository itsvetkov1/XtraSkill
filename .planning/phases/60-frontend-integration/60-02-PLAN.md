---
phase: 60-frontend-integration
plan: 02
type: execute
wave: 2
depends_on: ["60-01"]
files_modified:
  - frontend/lib/screens/conversation/conversation_screen.dart
  - frontend/lib/screens/conversation/widgets/provider_indicator.dart
autonomous: true

must_haves:
  truths:
    - "User can see which provider was used for a thread in the conversation screen"
    - "Thread info is accessible via an info button in the AppBar"
    - "Provider indicator below chat input shows correct provider name and icon for Claude Code providers"
    - "Experimental badge appears in thread info for Claude Code providers"
  artifacts:
    - path: "frontend/lib/screens/conversation/conversation_screen.dart"
      provides: "Info button in AppBar that shows thread details bottom sheet with provider info"
      contains: "showModalBottomSheet"
    - path: "frontend/lib/screens/conversation/widgets/provider_indicator.dart"
      provides: "Provider indicator that correctly displays Claude Code provider names and icons"
      contains: "ProviderConfigs.getConfig"
  key_links:
    - from: "frontend/lib/screens/conversation/conversation_screen.dart"
      to: "frontend/lib/core/constants.dart"
      via: "ProviderConfigs.getConfig for thread info display"
      pattern: "ProviderConfigs\\.getConfig"
    - from: "frontend/lib/screens/conversation/widgets/provider_indicator.dart"
      to: "frontend/lib/core/constants.dart"
      via: "ProviderConfigs.getConfig for provider icon and name"
      pattern: "ProviderConfigs\\.getConfig"
---

<objective>
Add thread info panel showing provider details in the conversation screen, enabling users to identify which provider was used for each thread.

Purpose: Phase 61 requires comparing quality across providers. Users need to see which provider was used per thread. Additionally, the ProviderIndicator widget below chat input already uses ProviderConfigs.getConfig(), so it automatically works with new providers — but we should verify and ensure experimental info is accessible.
Output: Info button in AppBar opens a bottom sheet showing thread details (title, provider with experimental badge, mode, created date). Provider indicator below chat input correctly shows Claude Code provider names.
</objective>

<execution_context>
@C:/Users/ibcve/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ibcve/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/60-frontend-integration/60-CONTEXT.md
@.planning/phases/60-frontend-integration/60-01-SUMMARY.md
@frontend/lib/screens/conversation/conversation_screen.dart
@frontend/lib/screens/conversation/widgets/provider_indicator.dart
@frontend/lib/core/constants.dart
@frontend/lib/models/thread.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add thread info bottom sheet with provider display</name>
  <files>
    frontend/lib/screens/conversation/conversation_screen.dart
  </files>
  <action>
    Add a thread info button to the AppBar and a method that shows a modal bottom sheet with thread details including provider information.

    **1. Add info icon button to AppBar actions** (before the edit/rename button, around line 278):
    ```dart
    IconButton(
      icon: const Icon(Icons.info_outline),
      tooltip: 'Thread info',
      onPressed: provider.thread != null ? _showThreadInfo : null,
    ),
    ```

    **2. Add _showThreadInfo() method** to _ConversationScreenState (after _showModeChangeDialog):
    ```dart
    void _showThreadInfo() {
      final thread = context.read<ConversationProvider>().thread;
      if (thread == null) return;

      final providerConfig = ProviderConfigs.getConfig(thread.modelProvider);

      showModalBottomSheet(
        context: context,
        builder: (sheetContext) => SafeArea(
          child: Padding(
            padding: const EdgeInsets.all(16),
            child: Column(
              mainAxisSize: MainAxisSize.min,
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                // Header
                Text(
                  'Thread Info',
                  style: Theme.of(sheetContext).textTheme.titleMedium?.copyWith(
                    fontWeight: FontWeight.w600,
                  ),
                ),
                const SizedBox(height: 16),
                // Title
                ListTile(
                  leading: const Icon(Icons.chat_bubble_outline),
                  title: const Text('Title'),
                  subtitle: Text(thread.title ?? 'New Conversation'),
                  dense: true,
                ),
                // Provider
                ListTile(
                  leading: Icon(providerConfig.icon, color: providerConfig.color),
                  title: const Text('Provider'),
                  subtitle: Row(
                    children: [
                      Text(providerConfig.displayName),
                      if (providerConfig.isExperimental) ...[
                        const SizedBox(width: 8),
                        Container(
                          padding: const EdgeInsets.symmetric(horizontal: 6, vertical: 2),
                          decoration: BoxDecoration(
                            color: Theme.of(sheetContext).colorScheme.secondaryContainer,
                            borderRadius: BorderRadius.circular(4),
                          ),
                          child: Text(
                            'EXPERIMENTAL',
                            style: TextStyle(
                              fontSize: 10,
                              fontWeight: FontWeight.w600,
                              color: Theme.of(sheetContext).colorScheme.onSecondaryContainer,
                            ),
                          ),
                        ),
                      ],
                    ],
                  ),
                  dense: true,
                ),
                // Model name (only for providers with modelName)
                if (providerConfig.modelName != null)
                  ListTile(
                    leading: const Icon(Icons.memory),
                    title: const Text('Model'),
                    subtitle: Text(providerConfig.modelName!),
                    dense: true,
                  ),
                // Mode
                ListTile(
                  leading: Icon(thread.modeIcon),
                  title: const Text('Mode'),
                  subtitle: Text(thread.modeDisplayName),
                  dense: true,
                ),
                // Created date
                ListTile(
                  leading: const Icon(Icons.calendar_today),
                  title: const Text('Created'),
                  subtitle: Text(_formatDate(thread.createdAt)),
                  dense: true,
                ),
                const SizedBox(height: 8),
              ],
            ),
          ),
        ),
      );
    }

    /// Format date for display in thread info
    String _formatDate(DateTime date) {
      return '${date.year}-${date.month.toString().padLeft(2, '0')}-${date.day.toString().padLeft(2, '0')} '
             '${date.hour.toString().padLeft(2, '0')}:${date.minute.toString().padLeft(2, '0')}';
    }
    ```

    **3. Add ProviderConfigs import** at the top of the file (it's already imported indirectly via provider_indicator.dart, but needs direct import for thread info):
    ```dart
    import '../../core/constants.dart';
    ```

    IMPORTANT: Do NOT add any provider-specific logic to the streaming display. The existing StreamingMessage, MessageBubble, and error widgets already work identically for all providers via the ChatEvent normalization. Do NOT check provider type in the message list builder.
  </action>
  <verify>
    Verify conversation_screen.dart has:
    1. Import for constants.dart
    2. Info icon button in AppBar actions
    3. _showThreadInfo() method with bottom sheet
    4. _formatDate() helper method
    5. No provider-specific streaming logic (no `if (provider == 'claude-code-sdk')` in _buildMessageList)
  </verify>
  <done>
    - Info button (info_outline icon) appears in conversation AppBar
    - Tapping info button shows bottom sheet with thread title, provider (with experimental badge for Claude Code), model name, mode, and created date
    - Bottom sheet uses Material 3 styling consistent with existing bottom sheets in the app
    - No provider-specific streaming display logic added
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify provider indicator handles new providers correctly</name>
  <files>
    frontend/lib/screens/conversation/widgets/provider_indicator.dart
  </files>
  <action>
    The ProviderIndicator widget already uses ProviderConfigs.getConfig(provider), which after Plan 01 will correctly resolve claude-code-sdk and claude-code-cli to their respective configs. However, the provider indicator currently only shows displayName. For Claude Code providers with longer names, we should also show the model name as a second line for clarity.

    Update the ProviderIndicator build method to optionally show model name below the display name:

    ```dart
    @override
    Widget build(BuildContext context) {
      final config = ProviderConfigs.getConfig(provider);

      return Container(
        padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),
        child: Row(
          mainAxisSize: MainAxisSize.min,
          children: [
            Icon(
              config.icon,
              size: 16,
              color: config.color,
            ),
            const SizedBox(width: 8),
            Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              mainAxisSize: MainAxisSize.min,
              children: [
                Text(
                  config.displayName,
                  style: Theme.of(context).textTheme.bodySmall?.copyWith(
                    color: Theme.of(context).colorScheme.onSurfaceVariant,
                  ),
                ),
                if (config.modelName != null)
                  Text(
                    config.modelName!,
                    style: Theme.of(context).textTheme.labelSmall?.copyWith(
                      color: Theme.of(context).colorScheme.outline,
                    ),
                  ),
              ],
            ),
          ],
        ),
      );
    }
    ```

    This shows "Claude Code (SDK)" on line 1 and "Claude Sonnet 4.5" on line 2 in the provider indicator. For existing providers (where modelName is null), it renders identically to the current single-line display.
  </action>
  <verify>
    Verify provider_indicator.dart:
    1. Uses Column for text layout (supports optional second line)
    2. Conditionally shows modelName only when non-null
    3. Existing providers with null modelName render identically to before (single line)
  </verify>
  <done>
    - Provider indicator shows "Claude Code (SDK)" + "Claude Sonnet 4.5" for claude-code-sdk threads
    - Provider indicator shows "Claude Code (CLI)" + "Claude Sonnet 4.5" for claude-code-cli threads
    - Provider indicator shows single line for existing providers (Claude, Gemini, DeepSeek) — no visual regression
  </done>
</task>

</tasks>

<verification>
1. AppBar has info button (info_outline icon) that shows thread info bottom sheet
2. Thread info bottom sheet displays provider name with experimental badge for Claude Code providers
3. Thread info bottom sheet displays model name for Claude Code providers
4. Thread info bottom sheet displays mode and created date
5. Provider indicator below chat input shows Claude Code provider name and model name
6. Provider indicator for existing providers renders identically to before (no regression)
7. No provider-specific streaming display logic exists in conversation_screen.dart
</verification>

<success_criteria>
- User can tap info button in conversation AppBar to see thread details including provider
- Claude Code providers show experimental badge in thread info
- Provider indicator correctly displays all 5 provider types
- Streaming display remains provider-agnostic (no provider checks in message rendering)
</success_criteria>

<output>
After completion, create `.planning/phases/60-frontend-integration/60-02-SUMMARY.md`
</output>
