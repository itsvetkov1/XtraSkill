---
phase: 02-project-document-management
plan: 02
type: execute
wave: 2
depends_on: [02-01]
files_modified:
  - backend/app/routes/projects.py
  - backend/main.py
  - frontend/lib/services/project_service.dart
  - frontend/lib/providers/project_provider.dart
  - frontend/lib/screens/projects/project_list_screen.dart
  - frontend/lib/screens/projects/project_detail_screen.dart
  - frontend/lib/widgets/responsive_master_detail.dart
  - frontend/lib/main.dart
autonomous: true

must_haves:
  truths:
    - "User can create project with name and optional description"
    - "User can view list of all their projects"
    - "User can update project name and description"
    - "User can open project to view contents (threads and documents)"
    - "Projects are isolated (user only sees their own projects)"
  artifacts:
    - path: "backend/app/routes/projects.py"
      provides: "Project CRUD API endpoints"
      exports: ["router"]
      min_lines: 80
    - path: "frontend/lib/services/project_service.dart"
      provides: "API client for projects"
      exports: ["ProjectService"]
    - path: "frontend/lib/providers/project_provider.dart"
      provides: "Project state management"
      exports: ["ProjectProvider"]
    - path: "frontend/lib/screens/projects/project_list_screen.dart"
      provides: "Project list UI"
      exports: ["ProjectListScreen"]
    - path: "frontend/lib/screens/projects/project_detail_screen.dart"
      provides: "Project detail master-detail view"
      exports: ["ProjectDetailScreen"]
  key_links:
    - from: "backend/app/routes/projects.py"
      to: "backend/app/utils/jwt.py:get_current_user"
      via: "Depends(get_current_user) on all endpoints"
      pattern: "Depends\\(get_current_user\\)"
    - from: "frontend/lib/providers/project_provider.dart"
      to: "frontend/lib/services/project_service.dart"
      via: "calls ProjectService methods"
      pattern: "ProjectService|_projectService"
    - from: "frontend/lib/screens/projects/project_list_screen.dart"
      to: "frontend/lib/providers/project_provider.dart"
      via: "Consumer<ProjectProvider>"
      pattern: "Consumer<ProjectProvider>"
---

<objective>
Implement project management with CRUD operations and responsive UI.

Purpose: Enable users to organize their work into named projects with descriptions. Projects serve as containers for documents and threads, providing the organizational structure for Phase 2. Covers requirements PROJ-01, PROJ-02, PROJ-03, PROJ-04, PROJ-05.

Output: Complete project management feature with backend API, frontend state management, and responsive master-detail UI following Phase 1 patterns.
</objective>

<execution_context>
@G:\.claude\get-shit-done\workflows\execute-plan.md
@G:\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@G:\git_repos\BA_assistant\.planning\REQUIREMENTS.md
@G:\git_repos\BA_assistant\.planning\phases\02-project-document-management\02-RESEARCH.md

# Previous plans
@G:\git_repos\BA_assistant\.planning\phases\02-project-document-management\02-01-PLAN.md

# Phase 1 patterns to reuse
@G:\git_repos\BA_assistant\backend\app\routes\auth.py
@G:\git_repos\BA_assistant\backend\app\utils\jwt.py
@G:\git_repos\BA_assistant\frontend\lib\providers\auth_provider.dart
@G:\git_repos\BA_assistant\frontend\lib\widgets\responsive_layout.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Project API Endpoints</name>
  <files>
backend/app/routes/projects.py
backend/main.py
  </files>
  <action>
Create backend/app/routes/projects.py with FastAPI router:

**POST /projects** - Create project:
- Accepts: {"name": str, "description": str | null}
- Validates: name length 1-255 chars
- Creates: Project with user_id from get_current_user
- Returns: {"id": str, "name": str, "description": str | null, "created_at": str, "updated_at": str}
- Status: 201 Created

**GET /projects** - List user's projects:
- Returns: [Project...] ordered by updated_at DESC (most recently modified first)
- Uses: selectinload for relationships (avoid lazy loading in async)
- Filters: WHERE user_id = current_user.id

**GET /projects/{project_id}** - Get project details:
- Returns: Project with documents and threads loaded (use selectinload for both relationships)
- Validates: project belongs to current_user (404 if not found or not owned)
- Returns: {"id": str, "name": str, "description": str | null, "created_at": str, "updated_at": str, "documents": [], "threads": []}

**PUT /projects/{project_id}** - Update project:
- Accepts: {"name": str, "description": str | null}
- Validates: project ownership, name length 1-255
- Updates: name, description, updated_at (auto via onupdate)
- Returns: Updated project object

All endpoints protected with Depends(get_current_user). Use async with selectinload from research Pattern 7 to avoid lazy loading issues.

Register router in main.py:
```python
from app.routes import projects
app.include_router(projects.router, prefix="/api", tags=["projects"])
```
  </action>
  <verify>
- Run backend: `cd backend && uvicorn main:app --reload --port 8000`
- Test create: `curl -X POST http://localhost:8000/api/projects -H "Authorization: Bearer <token>" -H "Content-Type: application/json" -d '{"name":"Test Project","description":"Test desc"}'` → 201
- Test list: `curl http://localhost:8000/api/projects -H "Authorization: Bearer <token>"` → returns array with created project
- Test get: `curl http://localhost:8000/api/projects/<id> -H "Authorization: Bearer <token>"` → returns project with documents/threads arrays
- Test update: `curl -X PUT http://localhost:8000/api/projects/<id> -H "Authorization: Bearer <token>" -d '{"name":"Updated"}'` → returns updated project
- Test auth: `curl http://localhost:8000/api/projects` (no token) → 401
  </verify>
  <done>
Project API endpoints working with proper authentication, validation, and relationship loading. All endpoints return correct status codes and filter by current user.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Frontend Project Service and Provider</name>
  <files>
frontend/lib/services/project_service.dart
frontend/lib/providers/project_provider.dart
frontend/lib/main.dart
  </files>
  <action>
**Create frontend/lib/services/project_service.dart:**
- Use Dio for HTTP requests (already established in Phase 1)
- Methods: getProjects(), createProject(name, description), getProject(id), updateProject(id, name, description)
- All methods include Authorization header from secure storage
- Parse responses using Project.fromJson()
- Handle errors (401 → trigger logout, 404 → not found, 500 → server error)

**Create frontend/lib/providers/project_provider.dart:**
- Extends ChangeNotifier (established Provider pattern from Phase 1)
- State: List<Project> _projects, Project? _selectedProject, bool _loading, String? _error
- Methods:
  - loadProjects() → fetches all projects, updates _projects, notifyListeners()
  - createProject(name, desc) → calls API, adds to _projects, notifyListeners()
  - selectProject(id) → loads project details, sets _selectedProject, notifyListeners()
  - updateProject(id, name, desc) → calls API, updates _projects and _selectedProject, notifyListeners()
- Use try/catch with _loading and _error state tracking

**Update frontend/lib/main.dart:**
Add ProjectProvider to MultiProvider:
```dart
MultiProvider(
  providers: [
    ChangeNotifierProvider(create: (_) => AuthProvider()),
    ChangeNotifierProvider(create: (_) => ProjectProvider()), // NEW
  ],
  child: MyApp(),
)
```

Follow research Pattern 8 "MultiProvider for Multiple State Objects".
  </action>
  <verify>
- Run `cd frontend && flutter analyze lib/services/project_service.dart lib/providers/project_provider.dart` → no errors
- Check ProjectService uses Dio with Authorization header
- Check ProjectProvider extends ChangeNotifier
- Check main.dart includes ProjectProvider in MultiProvider
- Verify error handling catches network errors and unauthorized
  </verify>
  <done>
Project service and provider created following Phase 1 patterns. State management integrated into app, ready for UI consumption.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Project UI with Responsive Master-Detail</name>
  <files>
frontend/lib/screens/projects/project_list_screen.dart
frontend/lib/screens/projects/project_detail_screen.dart
frontend/lib/widgets/responsive_master_detail.dart
frontend/lib/screens/home_screen.dart
  </files>
  <action>
**Create frontend/lib/widgets/responsive_master_detail.dart:**
Reusable widget for master-detail pattern:
- Mobile (<600px): Shows master list, tapping item navigates to detail screen
- Desktop (>=600px): Split view with master on left (300px), detail on right
- Uses ResponsiveHelper from Phase 1 to detect breakpoint
- Props: masterBuilder, detailBuilder, selectedId

**Create frontend/lib/screens/projects/project_list_screen.dart:**
- Uses Consumer<ProjectProvider> to reactively rebuild on state changes
- Calls loadProjects() in initState
- Shows CircularProgressIndicator while loading
- Shows error message if _error is not null
- ListView of project cards with name, description (truncated), updated_at
- FloatingActionButton to create new project (opens dialog)
- Create project dialog: TextField for name (required), TextField for description (optional)
- Taps project → navigate to ProjectDetailScreen (mobile) or update selectedId (desktop)

**Create frontend/lib/screens/projects/project_detail_screen.dart:**
- Shows project name, description, created/updated dates
- Tabs: "Documents" and "Threads"
- Edit button (AppBar action) → opens dialog to update name/description
- Empty state: "No documents yet" / "No threads yet" with action buttons
- Uses provider.selectProject(projectId) in initState to load details

**Update frontend/lib/screens/home_screen.dart:**
- Add "Projects" navigation item (drawer on mobile, rail on desktop)
- Route to ProjectListScreen
- Update GoRouter routes in main.dart to include /projects route

Follow research Pattern 9 "Responsive Master-Detail Layout" and reuse ResponsiveLayout from Phase 1.
  </action>
  <verify>
- Run `cd frontend && flutter run -d chrome` → app launches
- Resize browser window → verify master-detail layout switches at 600px
- Test create project: Tap FAB, enter name, submit → new project appears in list
- Test list projects: Projects display with name, description, updated date
- Test select project: Click project → detail view shows with tabs
- Test update project: Click edit button, change name, save → name updates in list and detail
- Test responsive: On mobile breakpoint, tapping project navigates; on desktop, shows split view
  </verify>
  <done>
Project UI complete with responsive master-detail layout, create/update dialogs, and navigation integrated into home screen. All PROJ requirements (01-05) visually testable.
  </done>
</task>

</tasks>

<verification>
1. Backend API endpoints return correct data for authenticated user
2. Frontend state management updates UI reactively on data changes
3. Responsive layout works at mobile (<600px) and desktop (>=600px) breakpoints
4. Create project flow: name required, description optional, appears in list immediately
5. Update project flow: edits persist and update both list and detail views
6. Project isolation: user only sees their own projects (test with two users if possible)
</verification>

<success_criteria>
- [ ] Backend: POST /projects creates project with user_id from JWT
- [ ] Backend: GET /projects returns only current user's projects
- [ ] Backend: GET /projects/{id} returns 404 if project not owned by user
- [ ] Backend: PUT /projects/{id} updates name and description
- [ ] Frontend: ProjectProvider manages state and calls ProjectService
- [ ] Frontend: Project list shows all user's projects ordered by updated_at DESC
- [ ] Frontend: Create project dialog validates name required, saves successfully
- [ ] Frontend: Project detail shows name, description, documents/threads tabs
- [ ] Frontend: Update project dialog persists changes and updates UI
- [ ] Responsive: Mobile shows list→detail navigation, desktop shows split view
- [ ] Requirements: PROJ-01, PROJ-02, PROJ-03, PROJ-04, PROJ-05 all satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/02-project-document-management/02-02-SUMMARY.md`
</output>
