---
phase: 10-polish-and-empty-states
plan: 05
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - frontend/lib/screens/projects/project_list_screen.dart
  - frontend/lib/screens/threads/thread_list_screen.dart
  - frontend/lib/screens/documents/document_list_screen.dart
  - frontend/lib/screens/projects/project_detail_screen.dart
autonomous: true

must_haves:
  truths:
    - "Dates <7 days show relative format (2h ago, 3 days ago)"
    - "Dates >=7 days show absolute format (Jan 18, 2026)"
    - "Thread list items show preview of last message"
    - "Project cards show thread and document count badges"
    - "Project detail header is consolidated (reduced vertical space)"
  artifacts:
    - path: "frontend/lib/screens/projects/project_list_screen.dart"
      provides: "Project cards with metadata badges and consistent dates"
      contains: "DateFormatter"
    - path: "frontend/lib/screens/threads/thread_list_screen.dart"
      provides: "Thread list with preview text and consistent dates"
      contains: "DateFormatter"
  key_links:
    - from: "frontend/lib/screens/projects/project_list_screen.dart"
      to: "frontend/lib/utils/date_formatter.dart"
      via: "import and DateFormatter.format()"
      pattern: "DateFormatter\\.format"
    - from: "frontend/lib/screens/threads/thread_list_screen.dart"
      to: "frontend/lib/utils/date_formatter.dart"
      via: "import and DateFormatter.format()"
      pattern: "DateFormatter\\.format"
---

<objective>
Apply visual polish: consistent date formatting, thread preview text, project metadata badges, and header consolidation.

Purpose: Implement POLISH-01 through POLISH-05 - consistent dates, thread previews, metadata badges, reduced header space.

Output: Polished UI with professional date formatting and enhanced list item information.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-polish-and-empty-states/10-RESEARCH.md
@frontend/lib/utils/date_formatter.dart
@frontend/lib/screens/projects/project_list_screen.dart
@frontend/lib/screens/threads/thread_list_screen.dart
@frontend/lib/screens/projects/project_detail_screen.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update date formatting across all screens</name>
  <files>
    frontend/lib/screens/projects/project_list_screen.dart
    frontend/lib/screens/threads/thread_list_screen.dart
    frontend/lib/screens/documents/document_list_screen.dart
    frontend/lib/screens/projects/project_detail_screen.dart
  </files>
  <action>
Replace all inline `_formatDate` methods with DateFormatter.format():

**ProjectListScreen:**
1. Import `../../utils/date_formatter.dart`
2. Remove the `_formatDate` method in `_ProjectCard` (lines 282-300)
3. Replace usage: `DateFormatter.format(project.updatedAt)` instead of `_formatDate(project.updatedAt)`

**ThreadListScreen:**
1. Import `../../utils/date_formatter.dart`
2. Remove the `_formatDate` method (lines 38-50)
3. Replace usage in subtitle: `DateFormatter.format(thread.createdAt)`

**DocumentListScreen:**
1. Import `../../utils/date_formatter.dart`
2. Remove the `_formatDate` method (lines 199-201)
3. Replace usage: `DateFormatter.format(doc.createdAt)`

**ProjectDetailScreen:**
1. Import `../../utils/date_formatter.dart`
2. Remove the `_formatDate` method (lines 291-293)
3. Replace usages in header: `DateFormatter.format(project.createdAt)` and `DateFormatter.format(project.updatedAt)`

This centralizes all date formatting and ensures POLISH-01 (relative <7d, absolute >=7d) and POLISH-05 (intl package).
  </action>
  <verify>
    - `flutter analyze` shows no errors
    - Recent dates show "2h ago", "3 days ago" format
    - Older dates show "Jan 18, 2026" format
    - No more inconsistent date formats
  </verify>
  <done>All screens use DateFormatter.format() for consistent relative/absolute date display</done>
</task>

<task type="auto">
  <name>Task 2: Add thread preview text and project metadata badges</name>
  <files>
    frontend/lib/screens/threads/thread_list_screen.dart
    frontend/lib/screens/projects/project_list_screen.dart
  </files>
  <action>
**ThreadListScreen - Add preview text (POLISH-03):**

The Thread model may need a `lastMessagePreview` field, but for now we can show existing info better:

1. Update subtitle in ListTile to show more useful preview:
   ```dart
   subtitle: Column(
     crossAxisAlignment: CrossAxisAlignment.start,
     children: [
       if (thread.summary != null && thread.summary!.isNotEmpty)
         Text(
           thread.summary!,
           maxLines: 1,
           overflow: TextOverflow.ellipsis,
           style: theme.textTheme.bodySmall,
         ),
       const SizedBox(height: 4),
       Text(
         '${DateFormatter.format(thread.updatedAt)} â€¢ $messageCount messages',
         style: theme.textTheme.bodySmall?.copyWith(
           color: theme.colorScheme.onSurfaceVariant,
         ),
       ),
     ],
   ),
   ```

Note: Thread model has `summary` field from AI summarization. Use that as preview if available.

**ProjectListScreen - Add metadata badges (POLISH-04):**

The Project model should have threadCount and documentCount. Check if available, otherwise show what we have:

1. Add a Row with metadata badges below description:
   ```dart
   // After description, before date
   const SizedBox(height: 8),
   Row(
     children: [
       // Thread count badge (if available)
       if (project.threadCount != null) ...[
         Icon(Icons.chat_bubble_outline, size: 16, color: theme.colorScheme.onSurfaceVariant),
         const SizedBox(width: 4),
         Text('${project.threadCount}', style: theme.textTheme.bodySmall),
         const SizedBox(width: 16),
       ],
       // Document count badge (if available)
       if (project.documentCount != null) ...[
         Icon(Icons.description_outlined, size: 16, color: theme.colorScheme.onSurfaceVariant),
         const SizedBox(width: 4),
         Text('${project.documentCount}', style: theme.textTheme.bodySmall),
         const SizedBox(width: 16),
       ],
       // Date (always shown)
       Text(
         'Updated ${DateFormatter.format(project.updatedAt)}',
         style: theme.textTheme.bodySmall?.copyWith(
           color: theme.colorScheme.onSurfaceVariant,
         ),
       ),
     ],
   ),
   ```

If Project model doesn't have these counts, check API response or omit for now (can be added in future backend enhancement).
  </action>
  <verify>
    - `flutter analyze` shows no errors
    - Thread list shows summary as preview (if available)
    - Project cards show thread/document counts (if available in model)
    - All metadata displays correctly
  </verify>
  <done>Thread list shows summary preview text; project cards show metadata badges with thread/document counts</done>
</task>

<task type="auto">
  <name>Task 3: Consolidate project detail header</name>
  <files>
    frontend/lib/screens/projects/project_detail_screen.dart
  </files>
  <action>
Consolidate the project header to reduce vertical space waste (POLISH-02):

Current header has:
- Project name row with edit/delete buttons
- Description (if exists)
- Created/Updated dates row

Consolidate to:
1. Single row with: Project name (expanded) + metadata chips + action buttons
2. Description below (if exists) - keep as is
3. Remove separate dates row, integrate into chips or omit (breadcrumb shows project name)

Updated layout:
```dart
Container(
  width: double.infinity,
  padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 12), // reduced from 16
  color: Theme.of(context).colorScheme.surfaceContainerHighest,
  child: Column(
    crossAxisAlignment: CrossAxisAlignment.start,
    mainAxisSize: MainAxisSize.min,
    children: [
      Row(
        children: [
          Expanded(
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(
                  project.name,
                  style: Theme.of(context).textTheme.titleLarge, // smaller than headlineSmall
                ),
                const SizedBox(height: 4),
                Text(
                  'Updated ${DateFormatter.format(project.updatedAt)}',
                  style: Theme.of(context).textTheme.bodySmall?.copyWith(
                    color: Theme.of(context).colorScheme.onSurfaceVariant,
                  ),
                ),
              ],
            ),
          ),
          IconButton(
            icon: const Icon(Icons.edit),
            tooltip: 'Edit Project',
            onPressed: () => _showEditProjectDialog(context),
          ),
          IconButton(
            icon: const Icon(Icons.delete_outline),
            tooltip: 'Delete Project',
            onPressed: () => _deleteProject(context),
          ),
        ],
      ),
      if (project.description != null && project.description!.isNotEmpty) ...[
        const SizedBox(height: 8),
        Text(
          project.description!,
          style: Theme.of(context).textTheme.bodyMedium,
        ),
      ],
    ],
  ),
),
```

Key changes:
- Reduced padding (12 vertical instead of 16)
- Smaller title (titleLarge instead of headlineSmall)
- Combined updated date into title area
- Removed created date (less important, reduces clutter)
  </action>
  <verify>
    - `flutter analyze` shows no errors
    - Project detail header takes less vertical space
    - Name, date, and action buttons visible on single line
    - Description shows below when present
  </verify>
  <done>Project detail header consolidated with reduced vertical space; name and updated date on same line</done>
</task>

</tasks>

<verification>
1. Run `flutter analyze` - no errors
2. Check project list - dates show relative/absolute correctly
3. Check project cards - metadata badges visible (if model has counts)
4. Check thread list - dates formatted consistently, summary shows as preview
5. Check document list - dates formatted consistently
6. Check project detail - header is more compact
</verification>

<success_criteria>
- All `_formatDate` methods removed, replaced with DateFormatter.format()
- Relative dates for <7 days, absolute for >=7 days
- Thread list shows summary as preview text
- Project cards show metadata badges (thread/doc counts if available)
- Project detail header consolidated (less vertical space)
- All code passes flutter analyze
</success_criteria>

<output>
After completion, create `.planning/phases/10-polish-and-empty-states/10-05-SUMMARY.md`
</output>
