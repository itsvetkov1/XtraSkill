---
phase: 10-polish-and-empty-states
plan: 04
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - frontend/lib/widgets/mode_selector.dart
  - frontend/lib/screens/conversation/conversation_screen.dart
  - frontend/lib/screens/conversation/widgets/message_bubble.dart
autonomous: true

must_haves:
  truths:
    - "User sees ChoiceChip buttons for Meeting Mode and Document Refinement Mode"
    - "User can tap chip to select mode instead of typing A or B"
    - "Selected mode is sent as user message"
    - "Message bubbles have improved padding and font size"
  artifacts:
    - path: "frontend/lib/widgets/mode_selector.dart"
      provides: "ChoiceChip mode selector widget"
      exports: ["ModeSelector"]
    - path: "frontend/lib/screens/conversation/widgets/message_bubble.dart"
      provides: "Message bubble with improved readability"
      min_lines: 40
  key_links:
    - from: "frontend/lib/screens/conversation/conversation_screen.dart"
      to: "frontend/lib/widgets/mode_selector.dart"
      via: "import and conditional display"
      pattern: "ModeSelector\\("
    - from: "frontend/lib/widgets/mode_selector.dart"
      to: "ConversationProvider.sendMessage"
      via: "onModeSelected callback"
      pattern: "onModeSelected"
---

<objective>
Enhance conversation UI with ChoiceChip mode selection and improved message readability.

Purpose: Implement CONV-UI-01 (mode selection via ChoiceChips) and CONV-UI-02 (message pill readability improvements).

Output: Users select AI mode by tapping chips instead of typing; messages are more readable with better padding and font size.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-polish-and-empty-states/10-RESEARCH.md
@frontend/lib/screens/conversation/conversation_screen.dart
@frontend/lib/screens/conversation/widgets/message_bubble.dart
@frontend/lib/providers/conversation_provider.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ModeSelector widget and integrate into ConversationScreen</name>
  <files>
    frontend/lib/widgets/mode_selector.dart
    frontend/lib/screens/conversation/conversation_screen.dart
  </files>
  <action>
**Create ModeSelector widget (frontend/lib/widgets/mode_selector.dart):**

```dart
import 'package:flutter/material.dart';

/// ChoiceChip-based mode selector for AI conversation modes
/// Displays Meeting Mode and Document Refinement Mode as tappable chips
class ModeSelector extends StatelessWidget {
  /// Callback when user selects a mode
  /// Returns the full mode name: "Meeting Mode" or "Document Refinement Mode"
  final ValueChanged<String> onModeSelected;

  const ModeSelector({super.key, required this.onModeSelected});

  @override
  Widget build(BuildContext context) {
    return Container(
      padding: const EdgeInsets.all(16),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Text(
            'Select conversation mode:',
            style: Theme.of(context).textTheme.titleMedium,
          ),
          const SizedBox(height: 12),
          Wrap(
            spacing: 12.0,
            runSpacing: 8.0,
            children: [
              ActionChip(
                avatar: const Icon(Icons.groups, size: 18),
                label: const Text('Meeting Mode'),
                onPressed: () => onModeSelected('Meeting Mode'),
              ),
              ActionChip(
                avatar: const Icon(Icons.edit_document, size: 18),
                label: const Text('Document Refinement'),
                onPressed: () => onModeSelected('Document Refinement Mode'),
              ),
            ],
          ),
          const SizedBox(height: 8),
          Text(
            'Meeting Mode: Real-time discovery with stakeholders\n'
            'Document Refinement: Refine existing requirements',
            style: Theme.of(context).textTheme.bodySmall?.copyWith(
              color: Theme.of(context).colorScheme.onSurfaceVariant,
            ),
          ),
        ],
      ),
    );
  }
}
```

Note: Using ActionChip (not ChoiceChip) because we want tap action, not toggle selection. ChoiceChip is for selecting from options where one stays selected.

**Integrate into ConversationScreen:**

1. Import `../../../widgets/mode_selector.dart`

2. In `_buildMessageList`, when messages.isEmpty and not streaming, show ModeSelector instead of current empty state:

```dart
if (messages.isEmpty && !provider.isStreaming) {
  return SingleChildScrollView(
    child: Column(
      children: [
        // Keep existing guidance text
        Padding(
          padding: const EdgeInsets.all(32),
          child: Column(
            children: [
              Icon(Icons.chat_bubble_outline, size: 64, color: Theme.of(context).colorScheme.outline),
              const SizedBox(height: 16),
              Text('Start a conversation', style: Theme.of(context).textTheme.titleMedium),
              const SizedBox(height: 8),
              Text(
                'Choose a mode to begin, or just start typing to ask about your requirements.',
                textAlign: TextAlign.center,
                style: TextStyle(color: Theme.of(context).colorScheme.onSurfaceVariant),
              ),
            ],
          ),
        ),
        // Mode selector below
        ModeSelector(
          onModeSelected: (mode) {
            // Send mode selection as user message
            provider.sendMessage(mode);
          },
        ),
      ],
    ),
  );
}
```

3. The ModeSelector sends the mode text as a message, which the AI will recognize and respond appropriately.
  </action>
  <verify>
    - `flutter analyze` shows no errors
    - Start new conversation and see mode selector chips
    - Tap "Meeting Mode" chip and verify message is sent
    - AI responds to mode selection
  </verify>
  <done>ModeSelector widget created; ConversationScreen shows mode chips for new conversations; tapping chip sends mode as message</done>
</task>

<task type="auto">
  <name>Task 2: Improve MessageBubble readability</name>
  <files>
    frontend/lib/screens/conversation/widgets/message_bubble.dart
  </files>
  <action>
Update MessageBubble to improve readability per CONV-UI-02:

1. Increase padding from 12 to 16:
   ```dart
   padding: const EdgeInsets.all(16), // was 12
   ```

2. Increase font size to 15-16px by specifying style explicitly:
   ```dart
   child: SelectableText(
     message.content,
     style: TextStyle(
       fontSize: 15, // Explicit font size for readability
       height: 1.4,  // Line height for better readability
       color: isUser
           ? theme.colorScheme.onPrimary
           : theme.colorScheme.onSurface,
     ),
   ),
   ```

3. Optionally increase margin slightly for better visual separation:
   ```dart
   margin: const EdgeInsets.symmetric(horizontal: 16, vertical: 6), // was vertical: 4
   ```

The changes should be subtle but improve overall readability, especially on mobile devices.
  </action>
  <verify>
    - `flutter analyze` shows no errors
    - Message bubbles visually have more padding
    - Text appears slightly larger and more readable
    - Conversation remains scrollable and functional
  </verify>
  <done>MessageBubble has increased padding (16px), larger font size (15px), and better line height (1.4) for improved readability</done>
</task>

</tasks>

<verification>
1. Run `flutter analyze` - no errors
2. Start new conversation - see mode selector with two chips
3. Tap "Meeting Mode" - message "Meeting Mode" appears in chat
4. AI responds acknowledging mode selection
5. Existing messages display with improved padding and font
6. Long conversations still scroll correctly
</verification>

<success_criteria>
- ModeSelector widget with Meeting Mode and Document Refinement chips
- Mode selector displayed for new conversations (empty message list)
- Tapping chip sends mode as user message
- MessageBubble has padding: 16, fontSize: 15, lineHeight: 1.4
- All code passes flutter analyze
</success_criteria>

<output>
After completion, create `.planning/phases/10-polish-and-empty-states/10-04-SUMMARY.md`
</output>
