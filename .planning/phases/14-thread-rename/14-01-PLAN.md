---
phase: 14-thread-rename
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/app/routes/threads.py
autonomous: true

must_haves:
  truths:
    - "PATCH /api/threads/{thread_id} updates thread title and returns updated thread"
    - "Only thread owner can rename their thread (returns 404 for others)"
    - "Empty/null title is allowed (clears title)"
    - "Title over 255 chars returns 400 error"
  artifacts:
    - path: "backend/app/routes/threads.py"
      provides: "ThreadUpdate model and rename_thread endpoint"
      contains: "@router.patch"
  key_links:
    - from: "PATCH /api/threads/{thread_id}"
      to: "Thread.title"
      via: "SQLAlchemy update"
      pattern: "thread\\.title = update_data\\.title"
---

<objective>
Add backend PATCH endpoint for renaming threads.

Purpose: Enable thread title updates via API (required before frontend can implement rename UI).
Output: Working PATCH /api/threads/{thread_id} endpoint that updates title and returns updated thread.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-thread-rename/14-RESEARCH.md

# Existing thread routes structure
@backend/app/routes/threads.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add PATCH endpoint for thread rename</name>
  <files>backend/app/routes/threads.py</files>
  <action>
Add ThreadUpdate Pydantic model and PATCH endpoint to threads.py:

1. Add ThreadUpdate model (after ThreadCreate):
   ```python
   class ThreadUpdate(BaseModel):
       """Request model for updating a thread."""
       title: Optional[str] = Field(None, max_length=255)
   ```

2. Add PATCH endpoint (after get_thread, before delete_thread):
   ```python
   @router.patch(
       "/threads/{thread_id}",
       response_model=ThreadResponse,
   )
   async def rename_thread(
       thread_id: str,
       update_data: ThreadUpdate,
       current_user: dict = Depends(get_current_user),
       db: AsyncSession = Depends(get_db),
   ):
   ```

3. Endpoint implementation:
   - Load thread with project (selectinload) for ownership check
   - Return 404 if thread not found
   - Return 404 if thread.project.user_id != current_user["user_id"]
   - Update thread.title = update_data.title
   - Commit and refresh
   - Return ThreadResponse

Follow the exact pattern from delete_thread for ownership validation. The title can be null (clears title) or any string up to 255 chars. Pydantic Field(max_length=255) handles validation automatically.
  </action>
  <verify>
Backend running: `cd backend && python -m uvicorn app.main:app --reload`

Test with curl (replace TOKEN and THREAD_ID):
```bash
# Rename thread
curl -X PATCH "http://localhost:8000/api/threads/THREAD_ID" \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"title": "Renamed Thread"}'
# Should return 200 with updated thread JSON

# Clear title (null)
curl -X PATCH "http://localhost:8000/api/threads/THREAD_ID" \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"title": null}'
# Should return 200 with title: null

# Invalid thread
curl -X PATCH "http://localhost:8000/api/threads/invalid-id" \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"title": "Test"}'
# Should return 404
```
  </verify>
  <done>
PATCH /api/threads/{thread_id} endpoint exists, accepts ThreadUpdate body with optional title, validates ownership, updates title in database, and returns ThreadResponse. Satisfies THREAD-04.
  </done>
</task>

</tasks>

<verification>
1. Backend starts without errors
2. PATCH endpoint responds to requests
3. Title updates persist in database
4. Ownership validation works (404 for non-owner)
5. Null title allowed (clears title)
</verification>

<success_criteria>
- THREAD-04 satisfied: Backend PATCH endpoint for thread rename
- Endpoint follows existing codebase patterns (threads.py structure)
- Ownership validation matches delete_thread pattern
- ThreadResponse returned with updated title and timestamps
</success_criteria>

<output>
After completion, create `.planning/phases/14-thread-rename/14-01-SUMMARY.md`
</output>
