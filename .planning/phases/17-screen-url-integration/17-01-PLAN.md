---
phase: 17-screen-url-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/lib/widgets/resource_not_found_state.dart
  - frontend/lib/providers/project_provider.dart
  - frontend/lib/screens/projects/project_detail_screen.dart
autonomous: true

must_haves:
  truths:
    - "User navigating to deleted project sees 'Project not found' message"
    - "User can navigate away from project not-found screen"
    - "Valid project still loads normally"
    - "404 error shows distinct UI from network errors"
  artifacts:
    - path: "frontend/lib/widgets/resource_not_found_state.dart"
      provides: "Reusable not-found UI widget"
      min_lines: 40
    - path: "frontend/lib/providers/project_provider.dart"
      provides: "isNotFound flag for 404 detection"
      contains: "isNotFound"
    - path: "frontend/lib/screens/projects/project_detail_screen.dart"
      provides: "Not-found state rendering"
      contains: "ResourceNotFoundState"
  key_links:
    - from: "frontend/lib/providers/project_provider.dart"
      to: "Exception('Project not found')"
      via: "error message parsing"
      pattern: "contains.*not found"
    - from: "frontend/lib/screens/projects/project_detail_screen.dart"
      to: "frontend/lib/widgets/resource_not_found_state.dart"
      via: "import and usage"
      pattern: "ResourceNotFoundState"
---

<objective>
Implement project not-found state (ERR-02) with reusable widget and provider flag.

Purpose: Users who navigate to deleted or inaccessible projects see a clear "Project not found" message with navigation options instead of a confusing error or blank screen.

Output: ResourceNotFoundState widget, ProjectProvider.isNotFound flag, ProjectDetailScreen not-found UI.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-screen-url-integration/17-RESEARCH.md

@frontend/lib/widgets/empty_state.dart
@frontend/lib/providers/project_provider.dart
@frontend/lib/screens/projects/project_detail_screen.dart
@frontend/lib/services/project_service.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ResourceNotFoundState widget</name>
  <files>frontend/lib/widgets/resource_not_found_state.dart</files>
  <action>
Create a reusable widget for "resource not found" states, matching the structure of EmptyState but with error styling:

```dart
/// Reusable not-found state widget for resources that don't exist.
///
/// Used when a valid URL route points to a deleted or inaccessible resource.
/// Distinct from EmptyState (no items yet) and ErrorState (network/server errors).
class ResourceNotFoundState extends StatelessWidget {
  /// Icon displayed at top (size: 64, error color)
  final IconData icon;

  /// Title text (e.g., "Project not found")
  final String title;

  /// Explanation message
  final String message;

  /// Label for navigation button
  final String buttonLabel;

  /// Navigation action
  final VoidCallback onPressed;

  // Constructor with all required fields

  @override
  Widget build(BuildContext context) {
    final theme = Theme.of(context);

    return Center(
      child: Padding(
        padding: const EdgeInsets.all(32.0),
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Icon(
              icon,
              size: 64,
              color: theme.colorScheme.error,  // Error color, not primary
            ),
            const SizedBox(height: 16),
            Text(title, style: theme.textTheme.titleLarge, textAlign: TextAlign.center),
            const SizedBox(height: 8),
            Text(
              message,
              textAlign: TextAlign.center,
              style: theme.textTheme.bodyMedium?.copyWith(
                color: theme.colorScheme.onSurfaceVariant,
              ),
            ),
            const SizedBox(height: 24),
            FilledButton.icon(
              onPressed: onPressed,
              icon: const Icon(Icons.arrow_back),
              label: Text(buttonLabel),
            ),
          ],
        ),
      ),
    );
  }
}
```

Key differences from EmptyState:
- Icon uses `theme.colorScheme.error` (not primary)
- Button icon is `Icons.arrow_back` (navigation away, not creation)
- No optional buttonIcon - always shows back arrow
  </action>
  <verify>flutter analyze frontend/lib/widgets/resource_not_found_state.dart</verify>
  <done>ResourceNotFoundState widget exists with error styling and back navigation button</done>
</task>

<task type="auto">
  <name>Task 2: Add isNotFound flag to ProjectProvider</name>
  <files>frontend/lib/providers/project_provider.dart</files>
  <action>
Add `_isNotFound` flag to distinguish 404 from other errors:

1. Add private field and getter:
```dart
/// Whether the selected project was not found (404)
bool _isNotFound = false;

/// Get not-found state - true when API returned 404
bool get isNotFound => _isNotFound;
```

2. Update `selectProject()` to detect 404:
```dart
Future<void> selectProject(String id) async {
  _loading = true;
  _error = null;
  _isNotFound = false;  // Reset on new selection
  notifyListeners();

  try {
    _selectedProject = await _projectService.getProject(id);
    _error = null;
  } catch (e) {
    final errorMessage = e.toString();
    // Check if it's a 404 "not found" error (from project_service.dart)
    if (errorMessage.contains('not found') ||
        errorMessage.contains('404')) {
      _isNotFound = true;
      _error = null;  // Not a "real" error, just not found
    } else {
      _error = errorMessage;
      _isNotFound = false;
    }
    _selectedProject = null;
  } finally {
    _loading = false;
    notifyListeners();
  }
}
```

3. Update `clearError()` to also clear isNotFound:
```dart
void clearError() {
  _error = null;
  _isNotFound = false;
  notifyListeners();
}
```

Note: The project_service.dart already throws "Project not found" for 404 responses (verified in research).
  </action>
  <verify>flutter analyze frontend/lib/providers/project_provider.dart</verify>
  <done>ProjectProvider has isNotFound getter that returns true when API returned 404 for project lookup</done>
</task>

<task type="auto">
  <name>Task 3: Update ProjectDetailScreen for not-found state</name>
  <files>frontend/lib/screens/projects/project_detail_screen.dart</files>
  <action>
Add ResourceNotFoundState import and update build() to show not-found UI:

1. Add import at top:
```dart
import '../../widgets/resource_not_found_state.dart';
```

2. Update the Consumer builder in build() to check isNotFound BEFORE error:
```dart
builder: (context, provider, child) {
  // Show loading indicator
  if (provider.loading && provider.selectedProject == null) {
    return const Center(child: CircularProgressIndicator());
  }

  // Show not-found state (ERR-02) - check BEFORE generic error
  if (provider.isNotFound) {
    return ResourceNotFoundState(
      icon: Icons.folder_off_outlined,
      title: 'Project not found',
      message: 'This project may have been deleted or you may not have access to it.',
      buttonLabel: 'Back to Projects',
      onPressed: () => context.go('/projects'),
    );
  }

  // Show error message (network/server errors)
  if (provider.error != null) {
    return Center(
      child: Column(
        // ... existing error UI with Retry button
      ),
    );
  }

  // ... rest of existing code
}
```

The key change: Check `isNotFound` BEFORE `error != null` because isNotFound sets error to null but is a distinct state.
  </action>
  <verify>flutter analyze frontend/lib/screens/projects/project_detail_screen.dart && flutter build web --no-tree-shake-icons</verify>
  <done>ProjectDetailScreen shows ResourceNotFoundState when provider.isNotFound is true, with "Back to Projects" navigation</done>
</task>

</tasks>

<verification>
1. `flutter analyze frontend/lib/widgets/` - No issues in widgets
2. `flutter analyze frontend/lib/providers/project_provider.dart` - No issues
3. `flutter analyze frontend/lib/screens/projects/project_detail_screen.dart` - No issues
4. `flutter build web --no-tree-shake-icons` - Build succeeds
</verification>

<success_criteria>
- ResourceNotFoundState widget created with error styling
- ProjectProvider.isNotFound returns true on 404, false otherwise
- ProjectDetailScreen shows "Project not found" with navigation for 404
- ProjectDetailScreen shows "Error loading project" with Retry for other errors
- All files pass flutter analyze
- Web build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/17-screen-url-integration/17-01-SUMMARY.md`
</output>
