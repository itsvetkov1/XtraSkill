---
phase: 13-auth-provider-display
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/lib/providers/auth_provider.dart
  - frontend/lib/screens/settings_screen.dart
autonomous: true

must_haves:
  truths:
    - "User sees their authentication provider in Settings profile section"
    - "Display reads 'Signed in with Google' or 'Signed in with Microsoft' based on login method"
    - "Provider display clears on logout and updates correctly on re-login"
  artifacts:
    - path: "frontend/lib/providers/auth_provider.dart"
      provides: "authProvider getter exposing oauth_provider from API"
      contains: "String? get authProvider"
    - path: "frontend/lib/screens/settings_screen.dart"
      provides: "Profile tile showing auth provider"
      contains: "Signed in with"
  key_links:
    - from: "frontend/lib/providers/auth_provider.dart"
      to: "/auth/me API response"
      via: "checkAuthStatus() and handleCallback() extracting oauth_provider"
      pattern: "oauth_provider.*as String"
    - from: "frontend/lib/screens/settings_screen.dart"
      to: "AuthProvider.authProvider"
      via: "Consumer<AuthProvider> reading authProvider getter"
      pattern: "authProvider\\.authProvider"
---

<objective>
Display the OAuth authentication provider (Google or Microsoft) in the Settings page profile section.

Purpose: Users can identify which OAuth provider they authenticated with, useful for troubleshooting and account management.

Output: Settings profile tile shows "Signed in with Google" or "Signed in with Microsoft" below the email address.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-auth-provider-display/13-RESEARCH.md

@frontend/lib/providers/auth_provider.dart
@frontend/lib/screens/settings_screen.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add authProvider field to AuthProvider</name>
  <files>frontend/lib/providers/auth_provider.dart</files>
  <action>
Add OAuth provider storage to AuthProvider class:

1. Add private field after existing user fields (line ~34):
   ```dart
   String? _authProvider;
   ```

2. Add getter after existing getters (after line ~58):
   ```dart
   /// OAuth provider used for authentication ("google" or "microsoft")
   String? get authProvider => _authProvider;
   ```

3. In `checkAuthStatus()` method, after extracting displayName (line ~78):
   ```dart
   _authProvider = user['oauth_provider'] as String?;
   ```

4. In `checkAuthStatus()` catch block, add after clearing displayName (line ~88):
   ```dart
   _authProvider = null;
   ```

5. In `handleCallback()` method, after extracting displayName (line ~159):
   ```dart
   _authProvider = user['oauth_provider'] as String?;
   ```

6. In `logout()` method try block, after clearing displayName (line ~188):
   ```dart
   _authProvider = null;
   ```

7. In `logout()` method catch block, after clearing displayName (line ~196):
   ```dart
   _authProvider = null;
   ```

The backend `/auth/me` already returns `oauth_provider` as "google" or "microsoft" string.
  </action>
  <verify>
Run `flutter analyze` in frontend directory - no errors or warnings related to auth_provider.dart.
Grep for `_authProvider` in auth_provider.dart - should appear in field declaration, getter, checkAuthStatus (2x), handleCallback (1x), logout (2x) = 7 occurrences.
  </verify>
  <done>
AuthProvider has `authProvider` getter that returns "google", "microsoft", or null.
Field is populated from API response and cleared on logout/error.
  </done>
</task>

<task type="auto">
  <name>Task 2: Display auth provider in Settings profile tile</name>
  <files>frontend/lib/screens/settings_screen.dart</files>
  <action>
Enhance the profile tile to show authentication provider:

1. Add helper method after `_getInitials()` method (after line ~145):
   ```dart
   String _formatProviderName(String provider) {
     switch (provider.toLowerCase()) {
       case 'google':
         return 'Google';
       case 'microsoft':
         return 'Microsoft';
       default:
         return provider;
     }
   }
   ```

2. Replace the entire `_buildProfileTile()` method (lines 118-137) with:
   ```dart
   Widget _buildProfileTile(BuildContext context, AuthProvider authProvider) {
     final email = authProvider.email ?? 'Unknown';
     final displayName = authProvider.displayName;
     final provider = authProvider.authProvider;
     final initials = _getInitials(displayName ?? email);

     // Determine if we need three lines:
     // Line 1: displayName (or email if no displayName)
     // Line 2: email (only if displayName exists)
     // Line 3: "Signed in with X" (if provider exists)
     final hasDisplayName = displayName != null;
     final hasProvider = provider != null;
     final isThreeLine = hasDisplayName && hasProvider;

     return ListTile(
       leading: CircleAvatar(
         backgroundColor: Theme.of(context).colorScheme.primaryContainer,
         child: Text(
           initials,
           style: TextStyle(
             color: Theme.of(context).colorScheme.onPrimaryContainer,
             fontWeight: FontWeight.bold,
           ),
         ),
       ),
       title: Text(displayName ?? email),
       subtitle: _buildProfileSubtitle(context, email, displayName, provider),
       isThreeLine: isThreeLine,
     );
   }

   Widget? _buildProfileSubtitle(
     BuildContext context,
     String email,
     String? displayName,
     String? provider,
   ) {
     final lines = <Widget>[];

     // Show email if we have a display name (email becomes secondary)
     if (displayName != null) {
       lines.add(Text(email));
     }

     // Show provider if available
     if (provider != null) {
       lines.add(
         Text(
           'Signed in with ${_formatProviderName(provider)}',
           style: Theme.of(context).textTheme.bodySmall?.copyWith(
             color: Theme.of(context).colorScheme.onSurfaceVariant,
           ),
         ),
       );
     }

     if (lines.isEmpty) return null;
     if (lines.length == 1) return lines.first;

     return Column(
       crossAxisAlignment: CrossAxisAlignment.start,
       children: lines,
     );
   }
   ```

Key points:
- Uses isThreeLine when both displayName and provider exist (3 lines total)
- Provider line uses bodySmall style with onSurfaceVariant color for visual hierarchy
- Handles null provider gracefully (no line shown)
- Format capitalizes provider name ("google" -> "Google")
  </action>
  <verify>
Run `flutter analyze` in frontend directory - no errors or warnings related to settings_screen.dart.
Grep for "Signed in with" in settings_screen.dart - should appear in _buildProfileSubtitle method.
  </verify>
  <done>
Settings profile tile shows "Signed in with Google" or "Signed in with Microsoft" below email.
Display adapts to 2-line or 3-line layout based on available data.
  </done>
</task>

</tasks>

<verification>
1. Run `flutter analyze` in frontend/ - should pass with no errors
2. Run frontend app, login with Google or Microsoft
3. Navigate to Settings page
4. Verify profile section shows:
   - Display name (if available)
   - Email
   - "Signed in with Google" or "Signed in with Microsoft"
5. Logout and re-login with different provider - verify display updates correctly
</verification>

<success_criteria>
- SETTINGS-01: Auth provider indicator shown in Settings profile section
- SETTINGS-02: Display format is "Signed in with Google" or "Signed in with Microsoft"
- Provider display clears on logout
- Provider display updates correctly on re-login
- No visual regressions in profile tile layout
</success_criteria>

<output>
After completion, create `.planning/phases/13-auth-provider-display/13-01-SUMMARY.md`
</output>
