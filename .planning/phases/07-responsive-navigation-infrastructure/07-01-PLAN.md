---
phase: 07-responsive-navigation-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/lib/providers/navigation_provider.dart
  - frontend/lib/widgets/responsive_scaffold.dart
autonomous: true
user_setup: []

must_haves:
  truths:
    - "NavigationProvider persists sidebar expanded/collapsed state to SharedPreferences"
    - "ResponsiveScaffold switches between NavigationRail (>=900px) and Drawer (<600px)"
    - "Tablet breakpoint (600-899px) shows collapsed NavigationRail (icons only)"
    - "NavigationRail destinations include Home, Projects, Settings"
    - "Provider loads saved state before app renders (prevent flash)"
  artifacts:
    - path: "frontend/lib/providers/navigation_provider.dart"
      provides: "Sidebar state management with persistence"
      exports: ["NavigationProvider"]
      min_lines: 50
    - path: "frontend/lib/widgets/responsive_scaffold.dart"
      provides: "Responsive shell widget for authenticated routes"
      exports: ["ResponsiveScaffold"]
      min_lines: 100
  key_links:
    - from: "frontend/lib/providers/navigation_provider.dart"
      to: "SharedPreferences"
      via: "immediate-persist pattern from ThemeProvider"
      pattern: "_prefs\\.setBool.*notifyListeners"
    - from: "frontend/lib/widgets/responsive_scaffold.dart"
      to: "frontend/lib/providers/navigation_provider.dart"
      via: "Consumer<NavigationProvider>"
      pattern: "Consumer<NavigationProvider>"
---

<objective>
Create NavigationProvider for sidebar state persistence and ResponsiveScaffold shell widget for responsive navigation layout.

Purpose: Establish the foundation for persistent navigation by creating the state management and UI shell that all authenticated screens will share.

Output:
- NavigationProvider with SharedPreferences persistence (same pattern as ThemeProvider)
- ResponsiveScaffold widget that switches between NavigationRail (desktop), collapsed NavigationRail (tablet), and Drawer (mobile)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-responsive-navigation-infrastructure/07-RESEARCH.md
@.planning/phases/07-responsive-navigation-infrastructure/07-CONTEXT.md

# Existing patterns to follow
@frontend/lib/providers/theme_provider.dart
@frontend/lib/widgets/responsive_layout.dart
@frontend/lib/core/config.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create NavigationProvider with SharedPreferences persistence</name>
  <files>frontend/lib/providers/navigation_provider.dart</files>
  <action>
Create NavigationProvider following the exact same pattern as ThemeProvider:

1. Private constructor with SharedPreferences instance and initial state
2. Static `load(SharedPreferences prefs)` factory method for async initialization
3. Storage key constants: `_sidebarExpandedKey` = 'sidebarExpanded'
4. State fields:
   - `_isSidebarExpanded` (bool, default true)
5. Getters:
   - `isSidebarExpanded` returns current state
6. Methods:
   - `toggleSidebar()` - toggles expanded state, persists BEFORE notifyListeners (critical for crash survival)

Use the immediate-persist pattern from ThemeProvider:
```dart
Future<void> toggleSidebar() async {
  _isSidebarExpanded = !_isSidebarExpanded;
  await _prefs.setBool(_sidebarExpandedKey, _isSidebarExpanded);
  notifyListeners();
}
```

Error handling: If persistence fails, still update UI (graceful degradation like ThemeProvider).

Do NOT include section states yet - per CONTEXT.md decision, sidebar state persistence is the priority. Section states can be added later if needed.
  </action>
  <verify>
Run `flutter analyze frontend/lib/providers/navigation_provider.dart` - no errors.
Verify file has static load() method matching ThemeProvider pattern.
  </verify>
  <done>
NavigationProvider exists with load() factory, toggleSidebar() method, and SharedPreferences persistence using immediate-persist pattern.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ResponsiveScaffold shell widget</name>
  <files>frontend/lib/widgets/responsive_scaffold.dart</files>
  <action>
Create ResponsiveScaffold widget that will wrap all authenticated routes:

1. Constructor parameters:
   - `required Widget child` - the current route's content
   - `required int currentIndex` - currently selected navigation destination
   - `required Function(int) onDestinationSelected` - callback for navigation

2. Build method uses LayoutBuilder (like ResponsiveLayout) with breakpoints from config.dart:
   - `>= Breakpoints.tablet (900)`: Desktop layout with NavigationRail (extended based on provider state)
   - `>= Breakpoints.mobile (600) && < Breakpoints.tablet`: Tablet layout with collapsed NavigationRail (icons only)
   - `< Breakpoints.mobile (600)`: Mobile layout with AppBar + hamburger opening Drawer

3. NavigationRail configuration:
   - `extended`: From NavigationProvider.isSidebarExpanded (desktop only)
   - `minExtendedWidth`: 250 (match home_screen.dart)
   - `labelType`: NavigationRailLabelType.none when extended (prevents assertion error)
   - `backgroundColor`: Theme.of(context).colorScheme.surfaceContainerLow
   - Leading widget: App branding (icon + "BA Assistant" + user email from AuthProvider)
   - Trailing widget: Expand/collapse toggle button (only on desktop)

4. NavigationRail destinations (same as current home_screen.dart):
   ```dart
   destinations: const [
     NavigationRailDestination(
       icon: Icon(Icons.home_outlined),
       selectedIcon: Icon(Icons.home),
       label: Text('Home'),
     ),
     NavigationRailDestination(
       icon: Icon(Icons.folder_outlined),
       selectedIcon: Icon(Icons.folder),
       label: Text('Projects'),
     ),
     NavigationRailDestination(
       icon: Icon(Icons.settings_outlined),
       selectedIcon: Icon(Icons.settings),
       label: Text('Settings'),
     ),
   ],
   ```

5. Drawer configuration (mobile):
   - Same navigation items as rail
   - DrawerHeader with app branding
   - ListTiles for each destination with selected state

6. Desktop layout structure:
   ```
   Row(
     children: [
       NavigationRail(...),
       VerticalDivider(thickness: 1, width: 1),
       Expanded(child: child),
     ],
   )
   ```

7. Mobile layout structure:
   ```
   Scaffold(
     appBar: AppBar(title: Text('BA Assistant')),
     drawer: Drawer(...),
     body: child,
   )
   ```

IMPORTANT: Do NOT include logout button in shell - that belongs in Settings page (Phase 8).
IMPORTANT: Use Consumer<NavigationProvider> to get sidebar state, not context.watch.
  </action>
  <verify>
Run `flutter analyze frontend/lib/widgets/responsive_scaffold.dart` - no errors.
Verify widget handles all three breakpoints (mobile, tablet, desktop).
Verify NavigationRail has labelType: none when extended (prevents assertion error).
  </verify>
  <done>
ResponsiveScaffold exists with LayoutBuilder-based responsive switching, NavigationRail for desktop/tablet, Drawer for mobile, and NavigationProvider integration for sidebar toggle.
  </done>
</task>

</tasks>

<verification>
1. `flutter analyze frontend/lib/providers/navigation_provider.dart` - no errors
2. `flutter analyze frontend/lib/widgets/responsive_scaffold.dart` - no errors
3. NavigationProvider follows ThemeProvider pattern (static load, immediate-persist)
4. ResponsiveScaffold handles three breakpoints with appropriate navigation pattern
</verification>

<success_criteria>
1. NavigationProvider persists sidebar state using SharedPreferences with immediate-persist pattern
2. ResponsiveScaffold renders NavigationRail on desktop (extended) and tablet (collapsed), Drawer on mobile
3. Both files pass flutter analyze with no errors
4. Files are ready to be integrated into main.dart in Plan 02
</success_criteria>

<output>
After completion, create `.planning/phases/07-responsive-navigation-infrastructure/07-01-SUMMARY.md`
</output>
