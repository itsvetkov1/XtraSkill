---
phase: 24-project-layout-redesign
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/lib/providers/document_column_provider.dart
  - frontend/lib/widgets/documents_column.dart
  - frontend/lib/main.dart
autonomous: true

must_haves:
  truths:
    - "DocumentColumnProvider exists and manages expanded/collapsed state"
    - "DocumentsColumn widget renders collapsed (48px) or expanded (280px) states"
    - "Provider is registered in MultiProvider before use"
  artifacts:
    - path: "frontend/lib/providers/document_column_provider.dart"
      provides: "Session-scoped column state management"
      exports: ["DocumentColumnProvider"]
    - path: "frontend/lib/widgets/documents_column.dart"
      provides: "Collapsible documents column widget"
      exports: ["DocumentsColumn"]
  key_links:
    - from: "frontend/lib/widgets/documents_column.dart"
      to: "DocumentColumnProvider"
      via: "Consumer widget"
      pattern: "Consumer<DocumentColumnProvider>"
    - from: "frontend/lib/main.dart"
      to: "DocumentColumnProvider"
      via: "ChangeNotifierProvider registration"
      pattern: "ChangeNotifierProvider.*DocumentColumnProvider"
---

<objective>
Create the DocumentColumnProvider and DocumentsColumn widget for collapsible documents sidebar.

Purpose: Establish the foundation components needed for the new project layout where documents appear in a collapsible side column instead of a tab.

Output: Provider managing column state, widget rendering collapsed/expanded views, provider registered in app.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-project-layout-redesign/24-RESEARCH.md

# Existing patterns
@frontend/lib/providers/navigation_provider.dart
@frontend/lib/main.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DocumentColumnProvider</name>
  <files>frontend/lib/providers/document_column_provider.dart</files>
  <action>
Create a session-scoped ChangeNotifier provider for document column state.

Implementation details:
- Private `_isExpanded` field, defaults to `false` (LAYOUT-03: minimized by default)
- `bool get isExpanded` getter
- `void toggle()` method - toggles state, calls notifyListeners
- `void expand()` method - sets expanded only if collapsed, calls notifyListeners
- `void collapse()` method - sets collapsed only if expanded, calls notifyListeners

Follow NavigationProvider pattern but SIMPLER:
- NO SharedPreferences (requirement says "within session" not "across restarts")
- NO async factory (no persistence to load)
- Just a simple ChangeNotifier with toggle/expand/collapse methods

File header:
```dart
/// Document column state management provider.
library;
```
  </action>
  <verify>File exists at frontend/lib/providers/document_column_provider.dart, contains DocumentColumnProvider class with isExpanded getter and toggle/expand/collapse methods</verify>
  <done>DocumentColumnProvider exists with session-scoped state management, defaulting to collapsed</done>
</task>

<task type="auto">
  <name>Task 2: Create DocumentsColumn widget</name>
  <files>frontend/lib/widgets/documents_column.dart</files>
  <action>
Create the collapsible documents column widget using AnimatedSize for smooth transitions.

Widget structure:
- `DocumentsColumn` StatelessWidget
- Constructor params: `required String projectId`
- Uses `Consumer<DocumentColumnProvider>` to read expanded state

Layout implementation:
- Wrap content in `AnimatedSize`:
  - duration: 200ms
  - curve: Curves.easeInOut
  - alignment: Alignment.centerLeft (expand from left edge)
- Child is `SizedBox` with width based on state:
  - Collapsed: 48px
  - Expanded: 280px

Collapsed state (_CollapsedStrip private widget):
- Container with surfaceContainerLow background
- Centered column with:
  - Icon: Icons.folder_outlined (document icon)
  - Tooltip: "Show documents"
- Entire strip is tappable (InkWell) -> calls provider.expand()

Expanded state (_ExpandedContent private widget):
- Container with surfaceContainerLow background
- Column layout:
  - Header row (16px padding):
    - Text "Documents" (titleSmall)
    - Spacer
    - IconButton: Icons.upload_file, tooltip "Upload document", calls _onUpload
    - IconButton: Icons.chevron_left, tooltip "Hide documents", calls provider.collapse()
  - Divider
  - Expanded child: Document list from ProjectProvider.selectedProject.documents
    - Use ListView.builder
    - Empty state: Center text "No documents"
    - Each item: ListTile with Icons.description, filename, tap to view document

Document operations (LAYOUT-06):
- Upload: Navigator.push to DocumentUploadScreen (existing pattern)
- View: Navigator.push to DocumentViewerScreen (existing pattern)
- Delete: PopupMenuButton on each ListTile with delete option -> DeleteConfirmationDialog -> DocumentProvider.deleteDocument

Import statements needed:
- flutter/material.dart
- provider/provider.dart
- go_router/go_router.dart
- ../providers/document_column_provider.dart
- ../providers/project_provider.dart
- ../providers/document_provider.dart
- ../screens/documents/document_upload_screen.dart
- ../screens/documents/document_viewer_screen.dart
- ../widgets/delete_confirmation_dialog.dart

File header:
```dart
/// Collapsible documents column widget for project layout.
library;
```
  </action>
  <verify>File exists at frontend/lib/widgets/documents_column.dart, contains DocumentsColumn widget that renders collapsed (48px) or expanded (280px) based on provider state</verify>
  <done>DocumentsColumn widget renders collapsed strip or expanded document list with upload/view/delete operations</done>
</task>

<task type="auto">
  <name>Task 3: Register DocumentColumnProvider in app</name>
  <files>frontend/lib/main.dart</files>
  <action>
Register DocumentColumnProvider in the MultiProvider so it's available throughout the app.

Changes to main.dart:

1. Add import at top:
```dart
import 'providers/document_column_provider.dart';
```

2. In MultiProvider.providers list, add after existing ChangeNotifierProviders:
```dart
ChangeNotifierProvider(create: (_) => DocumentColumnProvider()),
```

Place it near other UI-state providers (after NavigationProvider, before AuthProvider).

NOTE: Unlike NavigationProvider and ThemeProvider, this does NOT need:
- Async loading in main() (no persistence)
- Passing to MyApp constructor (no persistence)
- Using ChangeNotifierProvider.value (create fresh instance)
  </action>
  <verify>Run `flutter analyze` in frontend directory - no errors. DocumentColumnProvider import exists and is registered in MultiProvider</verify>
  <done>DocumentColumnProvider registered in app, available via context.read/watch/Consumer</done>
</task>

</tasks>

<verification>
1. `flutter analyze` passes with no errors
2. DocumentColumnProvider exists with toggle/expand/collapse methods
3. DocumentsColumn widget exists and compiles
4. Provider registered in main.dart MultiProvider
</verification>

<success_criteria>
1. DocumentColumnProvider manages expanded/collapsed state (default: collapsed)
2. DocumentsColumn renders 48px collapsed strip or 280px expanded panel
3. Collapsed strip shows folder icon, tappable to expand
4. Expanded panel shows document list with upload/view/delete operations
5. Provider registered in app and accessible
</success_criteria>

<output>
After completion, create `.planning/phases/24-project-layout-redesign/24-01-SUMMARY.md`
</output>
