---
phase: 04.1-agent-sdk-skill-integration
plan: 03
subsystem: api
tags: [brd-generation, artifact-types, template-validation, agent-tools]

# Dependency graph
requires:
  - phase: 04.1-01
    provides: claude-agent-sdk, skill_loader service
  - phase: 04.1-02
    provides: AgentService with search_documents_tool and save_artifact_tool
provides:
  - BRD artifact type in ArtifactType enum
  - BRD generator service with validation
  - generate_brd tool integrated into AgentService
affects: [frontend artifact display, BRD export, future artifact types]

# Tech tracking
tech-stack:
  added: []
  patterns: [template validation, pre-flight checklist, structured BRD generation]

key-files:
  created:
    - backend/app/services/brd_generator.py
  modified:
    - backend/app/models.py
    - backend/app/services/agent_service.py

key-decisions:
  - "BRD distinct from requirements_doc for full template compliance"
  - "Validation checks for required sections and technical language"
  - "15 parameters for generate_brd_tool covering all BRD sections"
  - "Context variables shared between agent_service and brd_generator modules"

patterns-established:
  - "BRD_REQUIRED_SECTIONS vs BRD_OPTIONAL_SECTIONS for validation"
  - "ValidationResult dataclass for structured validation output"
  - "format_preflight_checklist() for pre-generation readiness display"

# Metrics
duration: 4min
completed: 2026-01-25
---

# Phase 04.1 Plan 03: BRD Generation Tool Summary

**BRD artifact type with dedicated generate_brd tool following brd-template.md structure and pre-flight validation**

## Performance

- **Duration:** 4 min
- **Started:** 2026-01-25T07:15:23Z
- **Completed:** 2026-01-25T07:19:23Z
- **Tasks:** 3
- **Files modified:** 3

## Accomplishments
- Added BRD artifact type to ArtifactType enum
- Created brd_generator.py service with validation functions
- Defined generate_brd_tool with @tool decorator for all 15 BRD sections
- Integrated generate_brd_tool into AgentService
- Added BRD-specific tool_executing SSE event message

## Task Commits

Each task was committed atomically:

1. **Task 1: Add BRD artifact type to model** - `efef7da` (feat)
2. **Task 2: Create BRD generator service** - `c569e91` (feat)
3. **Task 3: Register generate_brd tool in AgentService** - `36e4135` (feat)

## Files Created/Modified
- `backend/app/models.py` - Added BRD = "brd" to ArtifactType enum
- `backend/app/services/brd_generator.py` - New BRD generator with validation
- `backend/app/services/agent_service.py` - Added generate_brd_tool integration

## Key Implementation Details

### ArtifactType Enum
```python
class ArtifactType(str, PyEnum):
    USER_STORIES = "user_stories"
    ACCEPTANCE_CRITERIA = "acceptance_criteria"
    REQUIREMENTS_DOC = "requirements_doc"
    BRD = "brd"  # Business Requirements Document
```

### BRD Sections
Required sections (must be present):
- Executive Summary
- Business Objectives
- User Personas
- Functional Requirements
- Success Metrics

Optional sections (recommended):
- Business Context
- User Flows and Journeys
- Business Processes
- Stakeholder Analysis
- Regulatory and Compliance Requirements
- Assumptions and Constraints
- Risks and Mitigation Strategies
- Next Steps

### Validation Features
- Checks for all required sections via regex pattern matching
- Warns on placeholder text ([TBD], [TODO], [Insert ...], etc.)
- Warns on technical implementation language (React, AWS, PostgreSQL, etc.)
- Returns ValidationResult dataclass with is_valid, missing_sections, warnings, section_count

### generate_brd_tool Parameters
All 15 BRD section contents as parameters:
- title, executive_summary, business_context
- primary_objective, secondary_objectives
- personas, user_flows, functional_requirements
- business_processes, stakeholder_analysis, success_metrics
- compliance_requirements, assumptions_constraints
- risks_mitigation, next_steps

### AgentService Integration
```python
# Tools list includes generate_brd_tool
tools=[search_documents_tool, save_artifact_tool, generate_brd_tool]

# Allowed tools includes BRD
allowed_tools=[
    "mcp__ba__search_documents",
    "mcp__ba__save_artifact",
    "mcp__ba__generate_brd"
]

# SSE event for BRD generation
elif "generate_brd" in tool_name:
    yield {"event": "tool_executing",
           "data": json.dumps({"status": "Generating Business Requirements Document..."})}
```

## Decisions Made
1. **BRD separate from requirements_doc:** BRD follows specific template structure; requirements_doc is IEEE 830-style
2. **Validation warnings vs errors:** Missing required sections fail validation; technical terms only warn
3. **Context variables reused:** brd_generator module uses same ContextVar pattern as agent_service
4. **15 parameters:** All BRD sections as separate parameters for structured generation

## Deviations from Plan
None - plan executed exactly as written.

## Issues Encountered
None - build proceeded smoothly.

## Testing Notes
- ArtifactType.brd value verified via Python import
- validate_brd_content() correctly identifies missing sections
- format_preflight_checklist() produces readable [x] and [ ] checklist
- AgentService loads 90k+ char skill prompt with all 3 tools

## Next Phase Readiness
- BRD generation tool ready for use in conversations
- Frontend can display BRD artifacts and export to PDF/Word/Markdown
- Ready for end-to-end testing of discovery-to-BRD workflow

---
*Phase: 04.1-agent-sdk-skill-integration*
*Completed: 2026-01-25*
