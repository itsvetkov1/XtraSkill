---
phase: 24-project-layout-redesign
plan: 02
type: execute
wave: 2
depends_on: ["24-01"]
files_modified:
  - frontend/lib/screens/projects/project_detail_screen.dart
autonomous: false

must_haves:
  truths:
    - "Opening project shows threads list immediately (not documents tab)"
    - "Documents column appears on left side of threads list"
    - "Column is minimized by default (48px strip)"
    - "Clicking strip expands column to show documents"
    - "Clicking collapse button minimizes column"
    - "Document upload/view/delete works from column"
  artifacts:
    - path: "frontend/lib/screens/projects/project_detail_screen.dart"
      provides: "Project detail with Row layout (DocumentsColumn + ThreadList)"
      contains: "Row"
  key_links:
    - from: "frontend/lib/screens/projects/project_detail_screen.dart"
      to: "DocumentsColumn"
      via: "widget import and usage in Row"
      pattern: "DocumentsColumn\\(projectId:"
    - from: "frontend/lib/screens/projects/project_detail_screen.dart"
      to: "ThreadListScreen"
      via: "always visible in Expanded"
      pattern: "Expanded.*ThreadListScreen"
---

<objective>
Refactor ProjectDetailScreen to show threads as primary view with documents in collapsible side column.

Purpose: Replace tab-based navigation (Documents/Threads tabs) with a threads-first layout where documents are accessible via a collapsible side column, reducing clicks to access conversations.

Output: ProjectDetailScreen uses Row layout with DocumentsColumn and ThreadListScreen, no more TabBar/TabBarView.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-project-layout-redesign/24-RESEARCH.md
@.planning/phases/24-project-layout-redesign/24-01-SUMMARY.md

# Current implementation
@frontend/lib/screens/projects/project_detail_screen.dart
@frontend/lib/screens/threads/thread_list_screen.dart
@frontend/lib/widgets/documents_column.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove TabController and TabBar infrastructure</name>
  <files>frontend/lib/screens/projects/project_detail_screen.dart</files>
  <action>
Remove the tab-based navigation infrastructure from ProjectDetailScreen.

Changes to _ProjectDetailScreenState:

1. Remove `with SingleTickerProviderStateMixin` from class declaration:
   - Before: `class _ProjectDetailScreenState extends State<ProjectDetailScreen> with SingleTickerProviderStateMixin`
   - After: `class _ProjectDetailScreenState extends State<ProjectDetailScreen>`

2. Remove TabController:
   - Delete: `late TabController _tabController;`
   - Delete entire initState TabController setup (lines ~43-52)
   - Keep the `WidgetsBinding.instance.addPostFrameCallback` for project loading
   - Delete dispose method entirely (only had TabController disposal)

3. In build method, keep Consumer<ProjectProvider> but modify returned Column:
   - Keep project info header Container (lines ~121-170)
   - DELETE the Material + TabBar widget (lines ~172-182)
   - DELETE the TabBarView widget (lines ~184-194)
   - These will be replaced in Task 2

Keep all helper methods: _showEditProjectDialog, _deleteProject, and _DocumentsTab class (for reference, though we may not use it).
  </action>
  <verify>File compiles with `flutter analyze` (may have errors about missing content - that's expected, Task 2 adds replacement)</verify>
  <done>TabController, SingleTickerProviderStateMixin, TabBar, and TabBarView removed from ProjectDetailScreen</done>
</task>

<task type="auto">
  <name>Task 2: Implement Row layout with DocumentsColumn and ThreadList</name>
  <files>frontend/lib/screens/projects/project_detail_screen.dart</files>
  <action>
Replace the removed tab content with Row-based layout.

1. Add import at top of file:
```dart
import '../../widgets/documents_column.dart';
```

2. In build method, after project info header Container, add:
```dart
// Main content area: Documents column + Threads list
Expanded(
  child: Row(
    children: [
      // Collapsible documents column (LAYOUT-02, 03, 04, 05, 06)
      DocumentsColumn(projectId: widget.projectId),

      // Vertical divider between column and threads
      const VerticalDivider(width: 1, thickness: 1),

      // Threads list - always visible, primary content (LAYOUT-01)
      Expanded(
        child: ThreadListScreen(projectId: widget.projectId),
      ),
    ],
  ),
),
```

3. Remove or comment out _DocumentsTab class:
   - It's no longer needed since DocumentsColumn handles document display
   - Either delete entirely or add deprecation comment

4. Remove unused imports:
   - `import '../documents/document_upload_screen.dart';` (now in documents_column.dart)
   - Keep other imports as they may be used

5. Load threads on init instead of on tab switch:
   - In initState, after project loading, add:
   ```dart
   // Load threads immediately (threads is primary view now)
   context.read<ThreadProvider>().loadThreads(widget.projectId);
   ```
   - This replaces the TabController listener that loaded threads on tab switch

Final structure of returned Column in build method:
```dart
return Column(
  children: [
    // Project info header (existing Container, ~50 lines)
    Container(...),

    // Main content area: Documents column + Threads list
    Expanded(
      child: Row(
        children: [
          DocumentsColumn(projectId: widget.projectId),
          const VerticalDivider(width: 1, thickness: 1),
          Expanded(
            child: ThreadListScreen(projectId: widget.projectId),
          ),
        ],
      ),
    ),
  ],
);
```
  </action>
  <verify>`flutter analyze` passes with no errors. Run app and navigate to a project - should show threads immediately with collapsed documents column on left</verify>
  <done>ProjectDetailScreen uses Row layout with DocumentsColumn (collapsible) and ThreadListScreen (primary, always visible)</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Project layout redesign replacing tabs with threads-first view and collapsible documents column:
- Threads list shows immediately when opening project (no tab switching)
- Documents column appears as 48px strip on left side
- Column expands to 280px when clicked, showing document list
- Document operations (upload, view, delete) work from column
  </what-built>
  <how-to-verify>
1. Start the app: `cd frontend && flutter run -d chrome`
2. Log in and navigate to an existing project
3. **LAYOUT-01 Verify:** Threads list shows immediately (not documents tab)
4. **LAYOUT-03 Verify:** Left side has thin strip with folder icon (minimized column)
5. **LAYOUT-04 Verify:** Click the strip - column expands showing "Documents" header and document list
6. **LAYOUT-06 Verify:** If documents exist, verify:
   - Click document opens viewer
   - Three-dot menu shows delete option
   - Upload button in header works
7. **LAYOUT-05 Verify:** Click chevron_left button - column collapses back to strip
8. **Session persistence:** Navigate away (Home) and back to project - column state preserved
9. **Empty project:** Create new project, verify empty state shows in both areas
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
1. `flutter analyze` passes with no errors
2. ProjectDetailScreen no longer uses TabController or TabBar
3. Threads list visible immediately on project open
4. Documents column renders collapsed by default
5. Column expand/collapse works smoothly (AnimatedSize)
6. Document upload/view/delete accessible from column
</verification>

<success_criteria>
1. Opening any project shows threads list immediately (LAYOUT-01)
2. Documents column visible on left side (LAYOUT-02)
3. Column minimized (48px) by default (LAYOUT-03)
4. Clicking strip expands column (LAYOUT-04)
5. Clicking collapse button minimizes column (LAYOUT-05)
6. Upload, view, delete work from column (LAYOUT-06)
7. Column state persists within session (navigate away and back)
</success_criteria>

<output>
After completion, create `.planning/phases/24-project-layout-redesign/24-02-SUMMARY.md`
</output>
