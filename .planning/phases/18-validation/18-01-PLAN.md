---
phase: 18-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/18-validation/18-VALIDATION.md
  - .planning/REQUIREMENTS.md
autonomous: false

must_haves:
  truths:
    - "All 16 v1.7 requirements verified end-to-end"
    - "ERR-04 (deleted resource via returnUrl) confirmed to work gracefully"
    - "Security validation confirms open redirect prevention"
    - "User can see test results with pass/fail status"
  artifacts:
    - path: ".planning/phases/18-validation/18-VALIDATION.md"
      provides: "Test matrix with results for all requirements"
      contains: "VAL-"
  key_links:
    - from: "Test matrix"
      to: "REQUIREMENTS.md"
      via: "Requirement ID references"
      pattern: "(ROUTE|URL|AUTH|ERR)-\\d+"
---

<objective>
Execute comprehensive end-to-end validation for all v1.7 deep linking features.

Purpose: Verify all 16 requirements work correctly, especially ERR-04 (deleted resource via returnUrl), and document results for milestone completion.
Output: 18-VALIDATION.md with test matrix, results, edge cases, and security validation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/18-validation/18-RESEARCH.md

# Prior implementation context
@.planning/phases/15-route-architecture/15-02-SUMMARY.md
@.planning/phases/16-auth-url-preservation/16-02-SUMMARY.md
@.planning/phases/17-screen-url-integration/17-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create comprehensive test matrix</name>
  <files>.planning/phases/18-validation/18-VALIDATION.md</files>
  <action>
Create 18-VALIDATION.md with a structured test matrix covering all 16 v1.7 requirements:

**Structure:**
1. Test Environment Setup section (backend/frontend start commands)
2. Test Matrix table with columns: Test ID, Requirement, Scenario, Steps, Expected, Status
3. Categories:
   - Route Navigation (ROUTE-01 through ROUTE-04)
   - URL Preservation (URL-01 through URL-04)
   - Auth Flow (AUTH-01 through AUTH-04)
   - Error Handling (ERR-01 through ERR-04)
4. Security Validation section:
   - External URL in returnUrl (should reject)
   - Malformed returnUrl (should fallback to /home)
5. Edge Cases section (blank, to be filled during testing)

**Test IDs:**
- VAL-01 through VAL-04: Route tests
- VAL-05 through VAL-08: URL preservation tests
- VAL-09 through VAL-12: Auth flow tests
- VAL-13 through VAL-16: Error handling tests
- SEC-01 through SEC-02: Security tests

Set all Status cells to "Pending" initially.
  </action>
  <verify>File exists with all 18 test cases (16 requirements + 2 security)</verify>
  <done>18-VALIDATION.md created with complete test matrix</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Execute validation tests</name>
  <what-built>Complete test matrix for v1.7 deep linking validation</what-built>
  <how-to-verify>
**Test Environment:**
1. Start backend: `cd backend && python run.py`
2. Start frontend: `cd frontend && flutter run -d chrome`
3. Use incognito window for clean state between auth tests

**Execute each test case in 18-VALIDATION.md:**
- Follow the steps column exactly
- Record actual behavior in the Status column
- Mark PASS or FAIL with notes

**Critical tests:**
- VAL-16 (ERR-04): Login with returnUrl pointing to deleted project
  - Create a project, note its ID
  - Delete the project
  - In incognito, access /projects/{deleted-id} while logged out
  - Complete OAuth login
  - Verify you see "Project not found" state (not crash)

- SEC-01: Try returnUrl with external URL
  - Manually set sessionStorage: `sessionStorage.setItem('returnUrl', 'https://evil.com')`
  - Complete OAuth login
  - Verify you land on /home (external URL rejected)

**Report results:**
After testing, report which tests passed/failed with any notes.
  </how-to-verify>
  <resume-signal>Report test results: list of PASS/FAIL for each test ID with any failure notes</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Update validation document with results</name>
  <files>.planning/phases/18-validation/18-VALIDATION.md, .planning/REQUIREMENTS.md</files>
  <action>
Based on user-reported test results from Task 2:

1. Update 18-VALIDATION.md:
   - Fill in Status column for each test (PASS/FAIL)
   - Add notes for any edge cases discovered
   - Add Edge Cases section content based on findings
   - Add Summary section with pass rate

2. Update REQUIREMENTS.md:
   - Mark ERR-04 as [x] complete (if VAL-16 passed)
   - Update traceability table (ERR-04: Complete)

If any tests FAILED:
- Document the failure in 18-VALIDATION.md
- Do NOT mark requirement as complete
- Note: Fix plans would be created separately if needed
  </action>
  <verify>18-VALIDATION.md has all Status cells filled; REQUIREMENTS.md updated for ERR-04</verify>
  <done>Validation results documented; requirements updated based on actual test results</done>
</task>

</tasks>

<verification>
- [ ] 18-VALIDATION.md exists with complete test matrix
- [ ] All 18 test cases executed and documented
- [ ] ERR-04 specifically verified (VAL-16)
- [ ] Security tests executed (SEC-01, SEC-02)
- [ ] REQUIREMENTS.md updated to reflect verified requirements
</verification>

<success_criteria>
1. All 16 v1.7 requirements have been manually verified
2. ERR-04 (returnUrl to deleted resource) confirmed to show graceful error
3. Security validation confirms no open redirect vulnerability
4. Test results documented with PASS/FAIL status for each requirement
</success_criteria>

<output>
After completion, create `.planning/phases/18-validation/18-01-SUMMARY.md`
</output>
