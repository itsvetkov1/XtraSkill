# Requirements Archive: v2.1 Rich Document Support

**Archived:** 2026-02-12
**Status:** SHIPPED

For current requirements, see `.planning/REQUIREMENTS.md`.

---

# Requirements: BA Assistant v2.1 Rich Document Support

**Defined:** 2026-02-12
**Core Value:** Business analysts reduce time spent on requirement documentation while improving completeness through AI-assisted discovery conversations that systematically explore edge cases and generate production-ready artifacts.

## v2.1 Requirements

Requirements for Rich Document Support milestone. Each maps to roadmap phases.

### Document Parsing

- [ ] **PARSE-01**: User can upload Excel (.xlsx) files with text extracted for AI context and search
- [ ] **PARSE-02**: User can upload CSV files with text extracted for AI context and search
- [ ] **PARSE-03**: User can upload PDF files with text extracted for AI context and search
- [ ] **PARSE-04**: User can upload Word (.docx) files with text extracted for AI context and search
- [ ] **PARSE-05**: Excel parsing preserves data types (leading zeros, dates, large numbers stored as strings)
- [ ] **PARSE-06**: CSV parsing auto-detects encoding (UTF-8, Windows-1252, UTF-8-BOM)

### Upload Validation & Security

- [ ] **SEC-01**: Server validates file type via content-type and magic number verification (not just extension)
- [ ] **SEC-02**: Maximum file size increased to 10MB for rich document formats
- [ ] **SEC-03**: XLSX/DOCX uploads protected against XXE attacks (defusedxml)
- [ ] **SEC-04**: XLSX/DOCX uploads protected against zip bombs (uncompressed size validation)
- [ ] **SEC-05**: Malformed files rejected with clear error message to user

### Storage & Search

- [ ] **STOR-01**: Original binary files stored encrypted alongside extracted text (dual-column storage)
- [ ] **STOR-02**: Extracted text indexed in FTS5 for full-text search across all document formats
- [ ] **STOR-03**: Document metadata stored (sheet names, row count, column headers, page count as applicable)

### Frontend Display

- [ ] **DISP-01**: Visual table preview shows first rows for Excel/CSV in upload confirmation dialog
- [ ] **DISP-02**: Sheet selector allows choosing which Excel sheets to parse for multi-sheet workbooks
- [ ] **DISP-03**: Document Viewer renders format-appropriate display (table grid for Excel/CSV, text for PDF/Word)
- [ ] **DISP-04**: Document metadata displayed in Document Viewer (format type, row/page count, sheet names)
- [ ] **DISP-05**: Table renderer supports sorting and handles large datasets without browser freeze (virtualization)

### AI Context Integration

- [ ] **AI-01**: AI document_search tool returns extracted text from all 4 rich document formats
- [ ] **AI-02**: Token budget management limits document context to prevent context window overflow
- [ ] **AI-03**: Source attribution chips show format-specific info (sheet name for Excel references)

### Export

- [ ] **EXP-01**: User can export parsed document data to Excel (.xlsx) format
- [ ] **EXP-02**: User can export parsed document data to CSV format

## Future Requirements

Deferred to v2.2+. Tracked but not in current roadmap.

### Advanced Parsing

- **ADV-01**: Table structure preservation for columnar data (AI understands column relationships)
- **ADV-02**: Word document order parsing (paragraphs and tables interspersed in original order)
- **ADV-03**: Multi-sheet context stitching (unified context with clear sheet separators)
- **ADV-04**: PDF table extraction with vision LLM for complex layouts (93% vs 67% accuracy)

### UX Enhancements

- **UX-01**: Drag-and-drop file upload
- **UX-02**: Batch upload for multiple files at once
- **UX-03**: Real-time upload progress indicator
- **UX-04**: Excel export for generated artifacts (requirements matrices)

## Out of Scope

| Feature | Reason |
|---------|--------|
| OCR for scanned PDFs | Tesseract dependency, low accuracy on complex layouts, text-based PDFs only for v2.1 |
| Real-time collaborative editing | Massive OT/CRDT complexity, single-user app |
| Excel calculation engine | Impossible to reimplement 30+ years of features; extract displayed values only |
| PDF editing/annotation | Out of scope for BA tool focused on AI context |
| Document version control | Complex conflict resolution; download-edit-reupload sufficient |
| Excel macro execution | Security risk, irrelevant for AI context extraction |
| Inline document editor | Feature creep; focus on AI-generated artifacts |

## Traceability

Which phases cover which requirements.

| Requirement | Phase | Status |
|-------------|-------|--------|
| PARSE-01 | Phase 54 | Pending |
| PARSE-02 | Phase 54 | Pending |
| PARSE-03 | Phase 54 | Pending |
| PARSE-04 | Phase 54 | Pending |
| PARSE-05 | Phase 54 | Pending |
| PARSE-06 | Phase 54 | Pending |
| SEC-01 | Phase 54 | Pending |
| SEC-02 | Phase 54 | Pending |
| SEC-03 | Phase 54 | Pending |
| SEC-04 | Phase 54 | Pending |
| SEC-05 | Phase 54 | Pending |
| STOR-01 | Phase 54 | Pending |
| STOR-02 | Phase 54 | Pending |
| STOR-03 | Phase 54 | Pending |
| DISP-01 | Phase 55 | Pending |
| DISP-02 | Phase 55 | Pending |
| DISP-03 | Phase 55 | Pending |
| DISP-04 | Phase 55 | Pending |
| DISP-05 | Phase 55 | Pending |
| AI-01 | Phase 55 | Pending |
| AI-02 | Phase 55 | Pending |
| AI-03 | Phase 55 | Pending |
| EXP-01 | Phase 56 | Pending |
| EXP-02 | Phase 56 | Pending |

**Coverage:**
- v2.1 requirements: 24 total
- Mapped to phases: 24
- Unmapped: 0
- Coverage: 100%

**Phase breakdown:**
- Phase 54 (Backend Foundation): 14 requirements (PARSE + SEC + STOR)
- Phase 55 (Frontend Display & AI): 8 requirements (DISP + AI)
- Phase 56 (Export Features): 2 requirements (EXP)

---
*Requirements defined: 2026-02-12*
*Traceability updated: 2026-02-12 after roadmap creation*
