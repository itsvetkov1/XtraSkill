---
phase: 10-polish-and-empty-states
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/pubspec.yaml
  - frontend/lib/utils/date_formatter.dart
  - frontend/lib/widgets/empty_state.dart
  - frontend/lib/main.dart
autonomous: true

must_haves:
  truths:
    - "Date formatting utility handles both relative and absolute formats"
    - "Relative dates shown for items <7 days old"
    - "Absolute dates shown for items >=7 days old"
    - "Empty state widget provides consistent template across app"
  artifacts:
    - path: "frontend/lib/utils/date_formatter.dart"
      provides: "Centralized date formatting utility"
      exports: ["DateFormatter"]
    - path: "frontend/lib/widgets/empty_state.dart"
      provides: "Reusable empty state widget"
      exports: ["EmptyState"]
  key_links:
    - from: "frontend/lib/utils/date_formatter.dart"
      to: "timeago package"
      via: "import and usage"
      pattern: "timeago\\.format"
    - from: "frontend/lib/main.dart"
      to: "frontend/lib/utils/date_formatter.dart"
      via: "DateFormatter.init() call"
      pattern: "DateFormatter\\.init"
---

<objective>
Create foundation infrastructure for Phase 10: DateFormatter utility class and reusable EmptyState widget.

Purpose: Establish consistent date formatting (POLISH-01, POLISH-05) and empty state presentation (ONBOARD-01 to ONBOARD-03) patterns before updating individual screens.

Output: Two utility files that all other plans in this phase will consume.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-polish-and-empty-states/10-RESEARCH.md
@frontend/pubspec.yaml
@frontend/lib/main.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add timeago package and create DateFormatter utility</name>
  <files>
    frontend/pubspec.yaml
    frontend/lib/utils/date_formatter.dart
    frontend/lib/main.dart
  </files>
  <action>
1. Add timeago package to pubspec.yaml:
   ```yaml
   dependencies:
     timeago: ^3.7.1
   ```
   Run `flutter pub get` after updating.

2. Create `frontend/lib/utils/date_formatter.dart` with:
   - Import `package:intl/intl.dart` and `package:timeago/timeago.dart as timeago`
   - Static `format(DateTime date)` method implementing POLISH-01:
     - If difference < 7 days: return `timeago.format(date)` for relative ("2h ago", "3 days ago")
     - If difference >= 7 days: return `DateFormat.yMMMd().format(date)` for absolute ("Jan 18, 2026")
   - Static `init()` method for initializing timeago locales (call early in app lifecycle)
   - Static `formatTime(DateTime date)` for time-only display ("5:08 PM") using `DateFormat.jm()`

3. Update `frontend/lib/main.dart`:
   - Import date_formatter.dart
   - Call `DateFormatter.init()` in main() after `WidgetsFlutterBinding.ensureInitialized()` but before theme loading
   - Ensure `initializeDateFormatting()` is called (import from `package:intl/date_symbol_data_local.dart`)
  </action>
  <verify>
    - `flutter pub get` completes without errors
    - `flutter analyze` shows no errors in new files
    - App starts without crashes (DateFormatter.init() executes)
  </verify>
  <done>DateFormatter utility exists with format(), formatTime(), and init() methods; timeago package added and initialized</done>
</task>

<task type="auto">
  <name>Task 2: Create reusable EmptyState widget</name>
  <files>
    frontend/lib/widgets/empty_state.dart
  </files>
  <action>
Create `frontend/lib/widgets/empty_state.dart` implementing the consistent empty state template from CONTEXT.md:

```dart
class EmptyState extends StatelessWidget {
  final IconData icon;
  final String title;
  final String message;
  final String buttonLabel;
  final VoidCallback onPressed;
  final IconData? buttonIcon; // Optional, defaults to Icons.add
```

Layout (following CONTEXT.md decisions):
1. Center widget with Column, mainAxisAlignment: center
2. Large themed icon (size: 64, color: theme.colorScheme.primary)
3. SizedBox(height: 16)
4. Title using theme.textTheme.titleLarge
5. SizedBox(height: 8)
6. Message using theme.textTheme.bodyMedium with onSurfaceVariant color, textAlign: center
7. SizedBox(height: 24)
8. FilledButton.icon (NOT ElevatedButton - per CONTEXT.md "Filled button for CTAs")
   - icon: buttonIcon ?? Icons.add
   - label: buttonLabel

The widget should be self-contained with no external dependencies beyond Flutter Material.
  </action>
  <verify>
    - `flutter analyze frontend/lib/widgets/empty_state.dart` shows no errors
    - Widget can be instantiated with required parameters
  </verify>
  <done>EmptyState widget exists with themed icon, encouraging message, and filled CTA button; ready for use in screens</done>
</task>

</tasks>

<verification>
1. Run `flutter pub get` in frontend directory
2. Run `flutter analyze` - should show no errors
3. Import DateFormatter and EmptyState in a test file to verify exports work
4. Start app with `flutter run` - should not crash on startup
</verification>

<success_criteria>
- timeago ^3.7.1 added to pubspec.yaml
- DateFormatter class with format(), formatTime(), init() methods
- EmptyState widget with icon, title, message, buttonLabel, onPressed params
- DateFormatter.init() called in main.dart before runApp
- All code passes flutter analyze
</success_criteria>

<output>
After completion, create `.planning/phases/10-polish-and-empty-states/10-01-SUMMARY.md`
</output>
