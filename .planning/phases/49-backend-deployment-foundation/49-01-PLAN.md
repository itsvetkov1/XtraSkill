---
phase: 49-backend-deployment-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/railway.json
  - backend/app/database.py
autonomous: true

must_haves:
  truths:
    - "railway.json includes healthcheckPath and healthcheckTimeout for Railway startup verification"
    - "database.py disables SQL echo logging when ENVIRONMENT=production"
    - "Health check endpoint exists at /health and returns 200 with status fields"
  artifacts:
    - path: "backend/railway.json"
      provides: "Railway deployment configuration with health check"
      contains: "healthcheckPath"
    - path: "backend/app/database.py"
      provides: "Environment-aware SQL echo configuration"
      contains: "echo="
  key_links:
    - from: "backend/railway.json"
      to: "backend/main.py"
      via: "healthcheckPath references /health endpoint"
      pattern: "healthcheckPath.*health"
---

<objective>
Prepare backend code for Railway deployment by adding health check configuration to railway.json and making database.py production-aware.

Purpose: The backend is already 95% deployment-ready. This plan addresses the remaining code-level gaps identified in research: railway.json needs health check config, and database.py has SQL echo=True hardcoded which floods production logs.

Output: Updated railway.json and database.py ready for Railway deployment.
</objective>

<execution_context>
@C:\Users\ibcve\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\ibcve\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/49-backend-deployment-foundation/49-RESEARCH.md
@backend/railway.json
@backend/app/database.py
@backend/app/config.py
@backend/main.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add health check config to railway.json and production-aware database settings</name>
  <files>backend/railway.json, backend/app/database.py</files>
  <action>
1. Update `backend/railway.json` to add health check configuration in the `deploy` section:
   - Add `"healthcheckPath": "/health"`
   - Add `"healthcheckTimeout": 300`
   The existing startCommand, restartPolicyType, and restartPolicyMaxRetries remain unchanged.

2. Update `backend/app/database.py` to make SQL echo environment-aware:
   - Import `settings` from `app.config`
   - Change `echo=True` to `echo=(settings.environment != "production")`
   This prevents SQL statement logging from flooding Railway deployment logs. In development, SQL logging continues as before.

Do NOT change the DATABASE_URL default value in database.py. The production DATABASE_URL will be set via Railway environment variable and picked up by `os.getenv("DATABASE_URL", ...)`. The default stays as the development fallback.

Do NOT modify main.py or config.py - they are already correctly configured (health endpoint exists, validation logic exists, BACKEND_URL validation exists via oauth_redirect_base_url property).
  </action>
  <verify>
- Run `python -c "import json; d=json.load(open('backend/railway.json')); assert d['deploy']['healthcheckPath'] == '/health'; assert d['deploy']['healthcheckTimeout'] == 300; print('railway.json OK')"` from project root
- Run `cd backend && python -c "from app.database import engine; print('Database module loads OK')"` to verify no import errors
- Run `cd backend && python -m pytest tests/ -x -q --tb=short` to verify no regressions
  </verify>
  <done>
- railway.json contains healthcheckPath="/health" and healthcheckTimeout=300 in deploy section
- database.py uses environment-aware echo setting (True in dev, False in production)
- All existing tests pass
  </done>
</task>

</tasks>

<verification>
- railway.json is valid JSON with health check configuration
- database.py imports settings and uses conditional echo
- No test regressions from changes
</verification>

<success_criteria>
Backend code is deployment-ready: railway.json has health check config, database.py suppresses SQL echo in production. No functional changes to existing behavior in development mode.
</success_criteria>

<output>
After completion, create `.planning/phases/49-backend-deployment-foundation/49-01-SUMMARY.md`
</output>
